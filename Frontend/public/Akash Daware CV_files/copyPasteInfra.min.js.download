function asyncGeneratorStep(e,t,r,o,a,n,i){try{var s=e[n](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(o,a)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var n=e.apply(t,r);function i(e){asyncGeneratorStep(n,o,a,i,s,"next",e)}function s(e){asyncGeneratorStep(n,o,a,i,s,"throw",e)}i(void 0)}))}}function _define_property(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),o.forEach((function(t){_define_property(e,t,r[t])}))}return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _object_spread_props(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var copyPasteInfra=function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=50)}({0:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryCollector=t.initStopwatchFactory=t.ConsoleLogger=t.NulLogger=t.perfWatch=t.browserSupport=t.LogCategory=t.TraceLevel=t.ULS=t.utils=t.replaceChildren=t.TextAreaInputMode=t.TextAreaVirtualKeyboardPolicy=t.getNewGuid=void 0;const o=r(5);t.utils=o;const a=r(2);Object.defineProperty(t,"ULS",{enumerable:!0,get:function(){return a.ULS}}),Object.defineProperty(t,"TraceLevel",{enumerable:!0,get:function(){return a.TraceLevel}}),Object.defineProperty(t,"LogCategory",{enumerable:!0,get:function(){return a.LogCategory}}),Object.defineProperty(t,"NulLogger",{enumerable:!0,get:function(){return a.NulLogger}}),Object.defineProperty(t,"ConsoleLogger",{enumerable:!0,get:function(){return a.ConsoleLogger}});const n=r(7);t.browserSupport=n;const i=r(8);t.perfWatch=i;const s=r(10);Object.defineProperty(t,"initStopwatchFactory",{enumerable:!0,get:function(){return s.initStopwatchFactory}});const c=r(11);Object.defineProperty(t,"TelemetryCollector",{enumerable:!0,get:function(){return c.TelemetryCollector}});var l=r(12);Object.defineProperty(t,"getNewGuid",{enumerable:!0,get:function(){return l.getNewGuid}});var d=r(13);Object.defineProperty(t,"TextAreaVirtualKeyboardPolicy",{enumerable:!0,get:function(){return d.TextAreaVirtualKeyboardPolicy}}),Object.defineProperty(t,"TextAreaInputMode",{enumerable:!0,get:function(){return d.TextAreaInputMode}});var u=r(14);Object.defineProperty(t,"replaceChildren",{enumerable:!0,get:function(){return u.replaceChildren}})},1:function(e,t,r){"use strict";r.d(t,"mc",(function(){return s})),r.d(t,"Eb",(function(){return c})),r.d(t,"Hb",(function(){return S})),r.d(t,"Ib",(function(){return b})),r.d(t,"Nb",(function(){return w})),r.d(t,"a",(function(){return L})),r.d(t,"D",(function(){return P})),r.d(t,"B",(function(){return T})),r.d(t,"t",(function(){return v})),r.d(t,"u",(function(){return I})),r.d(t,"M",(function(){return _})),r.d(t,"A",(function(){return A})),r.d(t,"K",(function(){return x})),r.d(t,"N",(function(){return F})),r.d(t,"L",(function(){return M})),r.d(t,"b",(function(){return O})),r.d(t,"m",(function(){return j})),r.d(t,"H",(function(){return D})),r.d(t,"c",(function(){return $})),r.d(t,"e",(function(){return U})),r.d(t,"J",(function(){return J})),r.d(t,"gc",(function(){return H})),r.d(t,"Db",(function(){return z})),r.d(t,"Mb",(function(){return K})),r.d(t,"Jb",(function(){return G})),r.d(t,"Lb",(function(){return q})),r.d(t,"Kb",(function(){return X})),r.d(t,"Gb",(function(){return Q})),r.d(t,"Ab",(function(){return Y})),r.d(t,"jb",(function(){return l})),r.d(t,"bc",(function(){return d})),r.d(t,"ac",(function(){return u})),r.d(t,"Yb",(function(){return p})),r.d(t,"Zb",(function(){return g})),r.d(t,"i",(function(){return m})),r.d(t,"j",(function(){return ee})),r.d(t,"p",(function(){return te})),r.d(t,"E",(function(){return re})),r.d(t,"k",(function(){return oe})),r.d(t,"q",(function(){return ae})),r.d(t,"F",(function(){return ne})),r.d(t,"P",(function(){return ie})),r.d(t,"hb",(function(){return se})),r.d(t,"ib",(function(){return ce})),r.d(t,"lc",(function(){return le})),r.d(t,"Cb",(function(){return de})),r.d(t,"hc",(function(){return ue})),r.d(t,"ic",(function(){return pe})),r.d(t,"Wb",(function(){return ge})),r.d(t,"Xb",(function(){return me})),r.d(t,"Rb",(function(){return fe})),r.d(t,"Vb",(function(){return he})),r.d(t,"Ub",(function(){return Ce})),r.d(t,"Qb",(function(){return ye})),r.d(t,"Sb",(function(){return Se})),r.d(t,"Tb",(function(){return be})),r.d(t,"qb",(function(){return we})),r.d(t,"sb",(function(){return Le})),r.d(t,"ob",(function(){return Pe})),r.d(t,"nb",(function(){return Te})),r.d(t,"R",(function(){return ve})),r.d(t,"mb",(function(){return Ie})),r.d(t,"lb",(function(){return _e})),r.d(t,"pb",(function(){return Ae})),r.d(t,"tb",(function(){return xe})),r.d(t,"g",(function(){return Me})),r.d(t,"r",(function(){return We})),r.d(t,"f",(function(){return f})),r.d(t,"n",(function(){return h})),r.d(t,"I",(function(){return C})),r.d(t,"d",(function(){return y})),r.d(t,"s",(function(){return Oe})),r.d(t,"xb",(function(){return Ze})),r.d(t,"qc",(function(){return et})),r.d(t,"C",(function(){return it})),r.d(t,"kc",(function(){return st})),r.d(t,"bb",(function(){return ct})),r.d(t,"U",(function(){return lt})),r.d(t,"kb",(function(){return dt})),r.d(t,"S",(function(){return pt})),r.d(t,"z",(function(){return gt})),r.d(t,"Pb",(function(){return mt})),r.d(t,"oc",(function(){return ft})),r.d(t,"T",(function(){return ht})),r.d(t,"pc",(function(){return Ct})),r.d(t,"h",(function(){return St})),r.d(t,"V",(function(){return wt})),r.d(t,"W",(function(){return vt})),r.d(t,"X",(function(){return yt})),r.d(t,"ab",(function(){return _t})),r.d(t,"cb",(function(){return At})),r.d(t,"Fb",(function(){return xt})),r.d(t,"nc",(function(){return Ft})),r.d(t,"dc",(function(){return Mt})),r.d(t,"yb",(function(){return Wt})),r.d(t,"O",(function(){return Ot})),r.d(t,"fb",(function(){return $t})),r.d(t,"db",(function(){return Ut})),r.d(t,"gb",(function(){return Ht})),r.d(t,"eb",(function(){return Rt})),r.d(t,"v",(function(){return kt})),r.d(t,"Ob",(function(){return zt})),r.d(t,"ub",(function(){return Vt})),r.d(t,"vb",(function(){return Bt})),r.d(t,"wb",(function(){return Kt})),r.d(t,"l",(function(){return Gt})),r.d(t,"G",(function(){return qt})),r.d(t,"o",(function(){return Xt})),r.d(t,"rb",(function(){return Qt})),r.d(t,"Q",(function(){return Yt})),r.d(t,"zb",(function(){return Ke})),r.d(t,"Z",(function(){return tr})),r.d(t,"x",(function(){return rr})),r.d(t,"Y",(function(){return Zt})),r.d(t,"w",(function(){return er})),r.d(t,"y",(function(){return or})),r.d(t,"cc",(function(){return je})),r.d(t,"ec",(function(){return $e})),r.d(t,"fc",(function(){return De})),r.d(t,"Bb",(function(){return a})),r.d(t,"jc",(function(){return o}));var o={};r.r(o),r.d(o,"sharedClipboardSettingsVariableName",(function(){return Ue})),r.d(o,"defaultPromiseTimeoutInMinutes",(function(){return Je})),r.d(o,"getSharedClipboardSettings",(function(){return Ne})),r.d(o,"initializeSharedClipboardSettingsFromWindow",(function(){return ke})),r.d(o,"initializeSharedClipboardSettings",(function(){return ze})),r.d(o,"createEmptySharedClipboardSettings",(function(){return Be}));var a={};r.r(a),r.d(a,"divTagName",(function(){return cr})),r.d(a,"preTagName",(function(){return lr})),r.d(a,"tableTagName",(function(){return dr})),r.d(a,"trTagName",(function(){return ur})),r.d(a,"tdTagName",(function(){return pr})),r.d(a,"ccpTimestampHtmlCustomAttributeName",(function(){return Cr})),r.d(a,"minCcpTimestampHtmlCustomAttributeValue",(function(){return yr})),r.d(a,"ensureOneLFPerNewLine",(function(){return Sr})),r.d(a,"trimToLength",(function(){return br})),r.d(a,"createTextHtmlFromTextPlain",(function(){return wr})),r.d(a,"createHtmlItemFromTextPlain",(function(){return Er})),r.d(a,"createPlainTextFromHtml",(function(){return Lr})),r.d(a,"isContainsTimestampWrapper",(function(){return Tr})),r.d(a,"addClipboardWrapperForEdge",(function(){return vr})),r.d(a,"getFragmentFromTextHtml",(function(){return Ir})),r.d(a,"getCcpTimestampHtmlCustomAttributeFromWrappingTag",(function(){return _r})),r.d(a,"getExternalSource",(function(){return Ar})),r.d(a,"encodeAngleBrackets",(function(){return xr})),r.d(a,"wrapContentWithTagAndAttributes",(function(){return Fr}));var n=r(0);let i;function s(){return i}function c(e){if(!e)throw new Error("The 'logger' argument is missing");i=n.ULS.getFromExternalLogger(e)}const l="",d=" ",u=".",p="1",g="1";var m,f,h,C,y;function S(e,t){return b(e,[t])}function b(e,t){if(!function(e){return!(!e||"object"!=typeof e||!("reason"in e))&&!!function(e){if(!e&&0!==e)return!1;const t=Number(e);return!isNaN(t)&&t.toString()===e.toString()}(e.reason)}(e))return!1;if(!t||!Array.isArray(t)||t.length<1)return!1;const r=e.reason;return t.indexOf(r)>=0}function w(e){if(e&&"object"==typeof e){if(E(e.reason))return!0;if(e.innerError&&"string"==typeof e.innerError)try{if(E(JSON.parse(e.innerError).reason))return!0}catch(e){}}if("string"==typeof e)try{if(E(JSON.parse(e).reason))return!0}catch(e){}return!1}function E(e){return e===f.LocalStorageInitilizationInaccessible}!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.FullAccessClipboardAndInMemory=3]="FullAccessClipboardAndInMemory",e[e.InMemory=4]="InMemory",e[e.LocalStorage=5]="LocalStorage",e[e.SystemClipboardAndLocalStorage=6]="SystemClipboardAndLocalStorage",e[e.SystemClipboardAndInMemory=7]="SystemClipboardAndInMemory",e[e.AsyncSystemClipboard=8]="AsyncSystemClipboard",e[e.AsyncSystemClipboardAndLocalStorage=9]="AsyncSystemClipboardAndLocalStorage",e[e.AsyncSystemClipboardAndInMemory=10]="AsyncSystemClipboardAndInMemory"}(m||(m={})),function(e){e[e.UnsupportedClipboardStrategyType=0]="UnsupportedClipboardStrategyType",e[e.UnsupportedClipboardStorageType=1]="UnsupportedClipboardStorageType",e[e.ClipboardIsInaccessible=2]="ClipboardIsInaccessible",e[e.SetClipboardItems=3]="SetClipboardItems",e[e.GetClipboardItems=5]="GetClipboardItems",e[e.NoGetOperationResultMessage=7]="NoGetOperationResultMessage",e[e.NoSetOperationResultMessage=8]="NoSetOperationResultMessage",e[e.ClearClipboardItems=9]="ClearClipboardItems",e[e.MissingBrowserExtensionCapability=10]="MissingBrowserExtensionCapability",e[e.NoBrowserExtensionsInConfiguration=11]="NoBrowserExtensionsInConfiguration",e[e.NoAvailableBrowserExtensions=12]="NoAvailableBrowserExtensions",e[e.UnavailableBrowserExtension=13]="UnavailableBrowserExtension",e[e.NoBrowserExtensionWithGetClipboardDataCommand=14]="NoBrowserExtensionWithGetClipboardDataCommand",e[e.SelectClipboardStrategy=15]="SelectClipboardStrategy",e[e.IframeInitialization=16]="IframeInitialization",e[e.UnsupportedOperationCode=26]="UnsupportedOperationCode",e[e.RejectingPendingPastePromiseDueToNewPasteOperation=27]="RejectingPendingPastePromiseDueToNewPasteOperation",e[e.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation=28]="RejectingPendingCutCopyPromiseDueToNewCutCopyOperation",e[e.RejectingBlockedSyncCutCopyPromise=29]="RejectingBlockedSyncCutCopyPromise",e[e.IframeInitializationTimeout=30]="IframeInitializationTimeout",e[e.ClipboardStrategyNotInitialized=33]="ClipboardStrategyNotInitialized",e[e.UnexpectedClipboardTextHtmlContentLength=34]="UnexpectedClipboardTextHtmlContentLength",e[e.InvalidClipboardStrategyType=35]="InvalidClipboardStrategyType",e[e.CreateWindowRPCServer=36]="CreateWindowRPCServer",e[e.RefreshMetadata=37]="RefreshMetadata",e[e.DeserializedMetadata=38]="DeserializedMetadata",e[e.SerializedMetadata=39]="SerializedMetadata",e[e.LocalStorageInitilizationInaccessible=40]="LocalStorageInitilizationInaccessible",e[e.LocalStorageInitilizationNoKey=41]="LocalStorageInitilizationNoKey",e[e.IframeProxyGeneralError=42]="IframeProxyGeneralError",e[e.IframeProxyEmptyResultMessage=43]="IframeProxyEmptyResultMessage"}(f||(f={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.CopyFlowHandlerNotFound=1]="CopyFlowHandlerNotFound",e[e.FetchCopyFlowHandlerFailed=2]="FetchCopyFlowHandlerFailed",e[e.FetchSourceItemFailed=3]="FetchSourceItemFailed",e[e.BeforeSerializeFailed=4]="BeforeSerializeFailed",e[e.SerializeFailed=5]="SerializeFailed",e[e.SerializeResultNotValid=6]="SerializeResultNotValid",e[e.AsyncSerializeFailed=7]="AsyncSerializeFailed",e[e.SaveToTheClipboardFailed=8]="SaveToTheClipboardFailed",e[e.InspectClipboardFailed=9]="InspectClipboardFailed",e[e.ClipboardIsInaccessible=10]="ClipboardIsInaccessible",e[e.SuccessiveCutCopyOverridingPendingCutCopy=11]="SuccessiveCutCopyOverridingPendingCutCopy",e[e.BlockedSynchronousCutCopy=12]="BlockedSynchronousCutCopy",e[e.CopyOperationCancelled=13]="CopyOperationCancelled",e[e.UnknownCopyErrorType=14]="UnknownCopyErrorType"}(h||(h={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.PasteFlowHandlerNotFound=1]="PasteFlowHandlerNotFound",e[e.FetchPasteFlowHandlerFailed=2]="FetchPasteFlowHandlerFailed",e[e.FailedToReadFromClipboard=3]="FailedToReadFromClipboard",e[e.InspectClipboardFailed=4]="InspectClipboardFailed",e[e.ReadFromClipboardReturnNullOrUndefined=5]="ReadFromClipboardReturnNullOrUndefined",e[e.ClipboardIsEmpty=6]="ClipboardIsEmpty",e[e.DeserializeOperationFailed=7]="DeserializeOperationFailed",e[e.ClipboardIsInaccessible=8]="ClipboardIsInaccessible",e[e.SuccessivePasteOverridingPendingPaste=9]="SuccessivePasteOverridingPendingPaste",e[e.FileReaderResultIsEmpty=10]="FileReaderResultIsEmpty",e[e.FileReaderFailed=11]="FileReaderFailed",e[e.UnknownPasteError=12]="UnknownPasteError",e[e.DeferredPasteRejectedBecauseOtherCopyCompleted=13]="DeferredPasteRejectedBecauseOtherCopyCompleted",e[e.DeferredPasteRejectedBecauseOtherCopyStarted=14]="DeferredPasteRejectedBecauseOtherCopyStarted",e[e.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext=15]="DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext"}(C||(C={})),function(e){e[e.FailedToClearClipboard=0]="FailedToClearClipboard"}(y||(y={}));class L extends Error{static augmentParameterValue(e){return e&&"string"==typeof e?e.trim():l}constructor(e,t,r){const o=L.augmentParameterValue(e);if(super(o),this.name=L.augmentParameterValue(t),this.errorName=this.name,this.name?s().ULS.traceTag(596456211,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Error '${this.name}': ${o}`):s().ULS.traceTag(596456212,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"Error message: "+o),r){this.innerError=r;let e=this.innerError.message;e||(e=this.innerError.name);const t=L.augmentParameterValue(e);t.length>0&&s().ULS.traceTag(596456213,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"Inner error message: "+t)}this.stack||(this.stack=(new Error).stack)}}class P extends L{constructor(e,t){super(e,"NoValidKeyError",t)}}class T extends L{static getDefaultMessage(e){let t="Missing argument";return e.length>0&&(t=`Missing argument: '${e}'`),t}constructor(e,t,r){const o=L.augmentParameterValue(t),a=T.getDefaultMessage(o);let n=L.augmentParameterValue(e);0===n.length&&(n=a),super(n,"MissingArgumentError",r),this.name=o}}class v extends L{static getDefaultMessage(e,t){return e.length>0?`Invalid '${e}' argument: '${t}'`:"Invalid argument"}constructor(e,t,r,o){const a=L.augmentParameterValue(t);let n=r;n||(n=l);const i=v.getDefaultMessage(a,n);let s=L.augmentParameterValue(e);0===e.length&&(s=i),super(s,"InvalidArgumentError",o),this.name=a,this.value=n}}class I extends L{constructor(e,t){super(e,"InvalidOperationError",t)}}class _ extends L{constructor(e,t){super(e,"UnsupportedError",t)}}class A extends L{constructor(e,t,r,o,a){super(`${e}. Data version: ${t}, Infra version: ${r}, blockMismatchDataVersion: ${o}`,"MismatchVersionError",a)}}class x extends L{constructor(e,t,r,o){super(`${e}. Duration in clipboard (ms) : ${t}, TTL (ms): ${r}`,"TTLClipboardDataError",o)}}class F extends L{constructor(e,t,r,o){super(`${e}. Data User Hash : ${t}, infra User Hash: ${r}`,"UserHashMismatchError",o)}}class M extends L{constructor(e,t){super(e,"UnexpectedError",t)}}function W(e,t){return function(e,t){return void 0!==e&&"number"==typeof e&&e>=0&&e<Object.keys(t).length/2}(e,t)?t[e]:l}class O extends L{constructor(e,t,r,o,a){super(t||"reason="+e,r,o),this.reason=e,a&&(this.errorName=a)}}class j extends O{constructor(e,t,r){super(e,t,"CopyError",r,W(e,h))}}class D extends O{constructor(e,t,r){super(e,t,"PasteError",r,W(e,C))}}class $ extends O{constructor(e,t,r){super(e,t,"CancelError",r,W(e,y))}}class U extends O{constructor(e,t,r){super(e,t,"ClipboardPlatformError",r,W(e,f))}}class J extends O{constructor(e,t,r){super(e,t,"SharedClipboardError",r,W(e,f))}}function H(e){if(!e||!Array.isArray(e)||0===e.length)return void s().ULS.traceTag(596456214,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"rethrowAfterAllActions: no actions to execute");let t=0,r=void 0;if(e.forEach(e=>{if(t+=1,e)try{e()}catch(e){s().ULS.traceTag(596456216,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`rethrowAfterAllActions: callback action #${t} threw an exception: ${e.message}`),r||(r=new I(e.message,e))}else s().ULS.traceTag(596456215,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`rethrowAfterAllActions: callback action #${t} is empty`)}),r)throw r}function R(){return N}const N={userAgent:()=>window&&window.navigator?window.navigator.userAgent:l,appVersion:()=>window&&window.navigator?window.navigator.appVersion:l};let k={};function z(){k={}}const V=new RegExp("(\\bTrident/| MSIE )"),B=new RegExp("\\bEdge/(\\d+\\.\\d+)\\b");function K(){if(void 0===k.isIEProperty){k.isIEProperty=!1;const e=R();if(e&&e.userAgent&&"function"==typeof e.userAgent){const t=e.userAgent();if(t){const e=t.match(V);e&&2===e.length&&(k.isIEProperty=!0)}}}return k.isIEProperty}function G(){if(void 0===k.isEdgeProperty){k.isEdgeProperty=!1,k.isEdgeWithTextHtmlClipboardSupportProperty=!1,k.isEdgeVersionWithTextHtmlWrapperSupportProperty=!1;const e=R();if(e&&e.appVersion&&"function"==typeof e.appVersion){const t=e.appVersion();if(t){const e=t.match(B);if(e&&2===e.length){k.isEdgeProperty=!0;const t=Number(e[1]);isNaN(t)||(t>=16.16299&&(k.isEdgeWithTextHtmlClipboardSupportProperty=!0),t>=17.17123&&(k.isEdgeVersionWithTextHtmlWrapperSupportProperty=!0))}}}}return k.isEdgeProperty}function q(){return G()&&k.isEdgeWithTextHtmlClipboardSupportProperty}function X(){return G()&&k.isEdgeVersionWithTextHtmlWrapperSupportProperty}function Q(){const e=R();let t=!1;if(e&&e.userAgent){const r=e.userAgent();r&&r.indexOf("Edg/")>=0&&(t=!0)}return t}function Y(){return Z}const Z={postMessage:(e,t,r,o)=>{e.postMessage(t,r,o)}},ee="copy",te="cut",re="paste",oe="copy",ae="cut",ne="paste",ie=(e,t,r,o=!1)=>(e.addEventListener(t,r,o),()=>{e.removeEventListener(t,r,o)}),se="text/plain",ce="Text",le="text/html",de="image/png",ue="data/shadow-workbook",pe="web data/shadow-workbook",ge="metadata/is-last-copy-was-external",me="metadata/is-last-copy-was-external-XLO-source",fe="metadata/chrome-extension-id",he="metadata/ccp-infra-version",Ce="copyId",ye="metadata/additional-signature-data-attributes",Se="metadata/copy-context",be="web metadata/copy-context";function we(){return{items:{}}}const Ee=function(){const e={items:{}};return{getData:()=>e,getItem:e=>{},setItem:(e,t)=>{throw new I(`Cannot set an item with clipboard data format '${e}' in an immutable empty clipboard (content is ${t&&t.length>0?"not ":l}empty)`)},hasDeferredItem:e=>!1,getDeferredItem:e=>{},get:()=>Fe(void 0)}}();function Le(){return Ee}function Pe(e){return e&&e.items?Object.keys(e.items).length:0}function Te(e){return Pe(e&&e.getData())}function ve(e){let t=e;t||(t={items:{}});const r=e=>Ie(t,e);return{getItem:r,setItem:(e,r)=>{!function(e,t,r){if(!e)throw new T(l,"clipboardItemsData");if(!e.items)throw new v(l,"clipboardItemsData.items");e.items[t]=r}(t,e,r)},hasDeferredItem:e=>{const t=r(e);return t&&t.length>0},getDeferredItem:e=>Promise.resolve(r(e)),getData:()=>t,get:()=>Fe(t)}}function Ie(e,t){if(!e)throw new T(l,"clipboardItemsData");if(!e.items)throw new v(l,"clipboardItemsData.items");return e.items[t]}function _e(e,t){if(!e||0===e.length||!t||!t.trim())return l;let r=void 0;return e.forEach(e=>{e.clipboardDataFormat===t&&(r=e.data)}),r||l}function Ae(e){return _e(e,se)}function xe(e){let t=[];return e&&(t=e.get()),0===t.length&&t.push({clipboardDataFormat:se,data:l}),t}function Fe(e){const t=[];if(0===Pe(e))return t;for(const r in e.items){let o=Ie(e,r);o||(o=l);const a={clipboardDataFormat:r,data:o,deferred:!1};t.push(a)}return t}var Me,We,Oe;!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.InMemory=2]="InMemory",e[e.LocalStorage=3]="LocalStorage",e[e.AsyncSystemClipboard=4]="AsyncSystemClipboard"}(Me||(Me={})),function(e){e[e.None=0]="None",e[e.Cut=1]="Cut",e[e.Copy=2]="Copy",e[e.Paste=4]="Paste",e[e.Values=16]="Values",e[e.Formatting=32]="Formatting",e[e.Formulas=64]="Formulas",e[e.DragDropCells=128]="DragDropCells",e[e.DragDropNoErrMsg=256]="DragDropNoErrMsg",e[e.Transpose=512]="Transpose",e[e.Link=1024]="Link",e[e.PictureInCell=2048]="PictureInCell",e[e.ColumnWidths=4096]="ColumnWidths",e[e.PasteValues=20]="PasteValues",e[e.PasteFormatting=36]="PasteFormatting",e[e.PasteFormulas=68]="PasteFormulas",e[e.PasteTranspose=516]="PasteTranspose",e[e.PasteLink=1028]="PasteLink",e[e.PastePictureInCell=2052]="PastePictureInCell",e[e.PasteWithColumnWidths=4100]="PasteWithColumnWidths"}(We||(We={})),function(e){e[e.NoError=0]="NoError",e[e.LocalStorageInaccessible=1]="LocalStorageInaccessible"}(Oe||(Oe={}));const je="BulsEndpointUrl",De="WacCluster",$e="usid",Ue="sharedClipboardSettings",Je=2;let He=Be(),Re=!1;function Ne(){if(!Re)throw new I("First initialize the settings via initializeSharedClipboardSettingsFromWindow() or initializeSharedClipboardSettings()");return He}function ke(){Re=!1,function(){if(!window||!(Ue in window))return He=Be(),void(Re=!0);const e=window[Ue];if(!e||"object"!=typeof e)return He=Be(),void(Re=!0);Ve(e)}()}function ze(e){Re=!1,Ve(e)}function Ve(e){if(!e)throw new T(l,"sharedClipboardSettingsCandidate");const t=Be();if("number"!=typeof e.sharedClipboardSchemaVersion||isNaN(e.sharedClipboardSchemaVersion)||(t.sharedClipboardSchemaVersion=e.sharedClipboardSchemaVersion),"number"!=typeof e.sharedClipboardExpirationInMinutes||isNaN(e.sharedClipboardExpirationInMinutes)||(t.sharedClipboardExpirationInMinutes=e.sharedClipboardExpirationInMinutes),"number"!=typeof e.clipboardPromiseTimeoutInMinutes||isNaN(e.clipboardPromiseTimeoutInMinutes)||(t.clipboardPromiseTimeoutInMinutes=e.clipboardPromiseTimeoutInMinutes),"string"==typeof e.remoteLoggerPath&&e.remoteLoggerPath&&e.remoteLoggerPath.trim()&&(t.remoteLoggerPath=e.remoteLoggerPath),"number"!=typeof e.whitelistOriginComponents||1!==e.whitelistOriginComponents)return He=t,void(Re=!0);if("string"!=typeof e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp.trim())return s().ULS.traceTag(596124181,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApp should be a non empty string"),He=t,void(Re=!0);t.sharedClipboardHostingApp=e.sharedClipboardHostingApp.trim();let r=t.sharedClipboardHostingApp;const o=r.indexOf("-");o>=0&&(r=r.substr(o+1));try{t.sharedClipboardHostingApps=e.sharedClipboardHostingApps?JSON.parse(e.sharedClipboardHostingApps):void 0}catch(t){s().ULS.traceTag(579737680,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps JSON parsing failed. String : "+e.sharedClipboardHostingApps)}if(!t.sharedClipboardHostingApps||!Array.isArray(t.sharedClipboardHostingApps)||0===t.sharedClipboardHostingApps.length||t.sharedClipboardHostingApps.some(e=>!e||!e.trim()))return s().ULS.traceTag(596124182,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps should be a JSON string representing an array with at list one app"),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],He=t,void(Re=!0);try{t.sharedClipboardHostingEnvironments=e.sharedClipboardHostingEnvironments?JSON.parse(e.sharedClipboardHostingEnvironments):void 0}catch(t){s().ULS.traceTag(579737681,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments JSON parsing failed. String : "+e.sharedClipboardHostingEnvironments)}if(!t.sharedClipboardHostingEnvironments||!Array.isArray(t.sharedClipboardHostingEnvironments)||0===t.sharedClipboardHostingEnvironments.length||t.sharedClipboardHostingEnvironments.some(e=>!e||!e.trim()))return s().ULS.traceTag(596124183,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments should be a JSON string representing an array with at list one environment"),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],He=t,void(Re=!0);if(t.sharedClipboardHostingApps.indexOf(t.sharedClipboardHostingApp)<0){if(t.sharedClipboardHostingApp===r)return s().ULS.traceTag(596124184,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],He=t,void(Re=!0);if(t.sharedClipboardHostingApps.indexOf(r)<0)return s().ULS.traceTag(596124185,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,`sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '${t.sharedClipboardHostingApp}' or '${r}' should be listed in sharedClipboardHostingApps`),t.sharedClipboardHostingApp=l,t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],He=t,void(Re=!0)}t.whitelistOriginComponents=!0,He=t,Re=!0}function Be(){return{whitelistOriginComponents:!1,sharedClipboardHostingApp:l,sharedClipboardHostingApps:[],sharedClipboardHostingEnvironments:[],sharedClipboardSchemaVersion:1,sharedClipboardExpirationInMinutes:3600,clipboardPromiseTimeoutInMinutes:Je,remoteLoggerPath:l}}function Ke(){let e=l;return window&&window.location&&window.location.origin?(e=window.location.origin,e||(e=l)):(s().ULS.traceTag(595932950,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`windowLocation.getWindowLocation: is window exist: ${!!window}. is window.location exist: ${window&&!!window.location}. is window.location.origin exist ${window&&window.location&&!!window.location.origin}. is window.location.protocol exist ${window&&window.location&&!!window.location.protocol}. is window.location.hostname exist ${window&&window.location&&!!window.location.hostname}. is window.location.port exist ${window&&window.location&&!!window.location.port}`),window&&window.location&&window.location.protocol&&window.location.hostname&&(e=window.location.protocol+"//"+window.location.hostname,window.location.origin=e)),{origin:e}}const Ge=new RegExp("^\\d+$");let qe,Xe,Qe=!1;function Ye(e){if(!e)throw new T(l,"origin");const t=e.trim().toLowerCase();let r=l,o=t.split("://",3);if(!o||0===o.length||!o[0]||"http"!==o[0]&&"https"!==o[0])throw new v("Missing protocol","origin",e);if(1===o.length)throw new v("Missing domain","origin",e);if(o.length>2)throw new v("'://' should appear once","origin",e);let a=o[1];if(!a)throw new v("Missing domain","origin",e);if(r=o[0]+"://",a=a.trim(),o=a.trim().split("/",3),!o||0===o.length||!o[0]||!o[0].trim())throw new v("Missing domain","origin",e);if(o.length>2)throw new v("The last part of the origin should be the domain","origin",e);if(2===o.length&&o[1])throw new v("The last part of the origin should be the domain","origin",e);if(o=a.split(":",3),!o||0===o.length||!o[0]||!o[0].trim())throw new v("Missing domain","origin",e);if(o.length>2||2===o.length&&(!o[1]||!o[1].trim()))throw new v("The last part of the origin should be the domain and an optional port number","origin",e);if(a=o[0].trim(),r+=a,2===o.length){const t=o[1].trim(),a=Ge.exec(t);if(!a||1!==a.length)throw new v("Invalid port number","origin",e);const n=Number(t);if(isNaN(n))throw new v("Invalid port number","origin",e);r+=":"+t}return s().ULS.traceTag(596452423,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`getValidatedOrigin: origin = '${e}'; validated origin = '${r}'`),r}function Ze(e){at();const t=Ye(e);let r=t.split("://");if(!r||2!==r.length||!r[0]||!r[1])throw new v("Invalid origin","parentOrigin",e);const o=Ne();let a=l;if(o.whitelistOriginComponents){const t=r[0]+"://";if(r=r[1].split("."),!r||r.length<2||!r[0])throw new v("Invalid origin","parentOrigin",e);r.splice(0,1,o.sharedClipboardHostingApp),a=t+r.join(".")}else a=t;return s().ULS.traceTag(596452424,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`getSharedClipboardValidatedOrigin: app's origin = '${e}'; Shared Clipboard iframe origin = '${a}' components=${JSON.stringify(r)}`),a}function et(e){at();const t=Ye(e),r=Ye(Ke().origin);if(t===r)return t;if(!Ne().whitelistOriginComponents)throw new I(`validateOriginForReceivedMessage: Caller origin '${e}' doesn't match the current window's origin '${r}'`);const o=tt(t),a=tt(r);if(o.protocol!==a.protocol)throw new I(`validateRemoteWindowOrigin: Caller origin's protocol '${o.protocol}' doesn't match the current window origin's protocol '${a.protocol}'`);if(o.environment!==a.environment)throw new I(`validateRemoteWindowOrigin: Caller origin's environment '${o.environment}' doesn't match the current window origin's environment '${a.environment}'`);return t}function tt(e){at();const t=e.split("://",2),r=t[0],o=rt(t[1]),a={protocol:r};if(a.environment=ot(e,o,Xe),o.length<=a.environment.length+1)throw new v("Missing app component","origin",e);if("."!==o.charAt(a.environment.length))throw new v("Missing a domain separator after the environment component","origin",e);const n=o.substr(a.environment.length+".".length);if(a.app=ot(e,n,qe),a.app.length<n.length&&"-"!==n.charAt(a.app.length))throw new v("When the Office Online app name is not the domain prefix, '-' should precede it","origin",e);return a}function rt(e){if(!e)throw new T(l,"stringToReverse");const t=e.length;let r=l;for(let o=t-1;o>=0;o-=1)r+=e.charAt(o);return r}function ot(e,t,r){if(!t)throw new T(l,"reversedValidatedHostname");if(!r)throw new T(l,"reversedStringsToLengthMap");const o=t.length,a=Object.keys(r).filter(e=>{const a=r[e];return a<=o&&t.substr(0,a)===e});if(a&&a.length>0)return rt(a[0]);throw new v("Invalid origin","validatedOrigin",e)}function at(){if(Qe)return;const e=Ne();e.whitelistOriginComponents&&(qe=nt(e.sharedClipboardHostingApps),Xe=nt(e.sharedClipboardHostingEnvironments),Qe=!0)}function nt(e){const t={};return e&&Array.isArray(e)&&0!==e.length?(e.forEach(e=>{t[rt(e)]=e.length}),t):t}const it=1;function st(e,t){return null==e||e===it||null==t||e!==t}function ct(){return ut()}function lt(){return ut()}function dt(e){if(!e)throw new T(l,"id");const t=e.trim().toLowerCase();if(0===t.length)throw new v(l,"id");return t}function ut(){return(Math.random()+1).toString(36).substring(7)}function pt(e,t,r,o,a){const n={id:e,operationCode:t,destination:r,userHash:o,clipboardItemsData:a};return ft(n),n}class gt{}function mt(e){return"get"===e||"set"===e||"init"===e}gt.localStorageData="localStorage/data",gt.localStorageMetadata="localStorage/metadata",gt.initIframe="initIframe";const ft=function(e){if(!e)throw new T(l,"clipboardOperationMessage");if(!e.id||0===e.id.trim().length)throw new T(l,"id");if(!e.operationCode)throw new T(l,"operationCode");if(!e.destination)throw new T(l,"destination");if(!mt(e.operationCode))throw new v(l,"operationCode",e.operationCode);if("set"!==e.operationCode&&e.clipboardItemsData)throw new v(`'${e.operationCode}' expects no clipboard items`,"clipboardItemsData")};function ht(e,t,r,o,a){const n={id:e,operationCode:t,failed:r,error:o,clipboardItemsData:a};return Ct(n),n}const Ct=function(e){if(!e)throw new T(l,"clipboardOperationResultMessage");const t=["failed","error","clipboardItemsData","operationCode","id","userHash"];let r=!1;for(const o of t)if(e.hasOwnProperty(o)){r=!0;break}if(!r)throw new P("clipboardOperationResultMessage has no valid key");if(!e.id||0===e.id.trim().length)throw s().ULS.traceTag(553747865,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`Missing argument 'id'. keys: ${JSON.stringify(Object.keys(e))}, isConstructorObject: ${e.constructor===Object}, operationCode: ${e.operationCode}, id: ${e.id}, failed: ${e.failed}, error: ${e.error}.`),new T(l,"id");if(!e.operationCode)throw new T(l,"operationCode");if("getresult"!==e.operationCode&&"setresult"!==e.operationCode&&"initresult"!==e.operationCode&&"unknownresult"!==e.operationCode&&"getMetadata_longPollingresult"!==e.operationCode)throw new v(l,"operationCode",e.operationCode);if(e.failed){if(!e.error)throw new v(`A failed '${e.operationCode}' operation expects a non-empty error argument`,"error");if(e.clipboardItemsData)throw new v(`A failed '${e.operationCode}' operation does not expect a clipboardItemsData argument`,"clipboardItemsData")}else{if(e.error)throw new v(`'${e.operationCode}' expects an empty error argument`,"error");if("unknownresult"===e.operationCode)throw new v(`'${e.operationCode}' can only be used with a failure message`,"operationCode")}if("getresult"===e.operationCode||"getMetadata_longPollingresult"===e.operationCode){if(!e.failed&&!e.clipboardItemsData)throw new v(`'${e.operationCode}' expects a clipboardItems argument`,"clipboardItemsData")}else if(e.clipboardItemsData)throw new v(`'${e.operationCode}' expects no clipboardItemsData argument`,"clipboardItemsData")};function yt(e){if(!e||0===e.trim().length)throw new v(l,"className",e);return(()=>{let t=!1;function r(t){return`${e}:${t}: already disposed`}return{dispose:function(){t=!0},logIfDisposed:function(e){return t&&s().ULS.traceTag(596456217,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,r(e)),t},throwIfDisposed:function(e){if(t)throw new I(r(e))}}})()}class St{initialize(e){return e.then(e=>(this.clipboardStorage=e,s().ULS.traceTag(596453007,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Clipboard strategy type '${this.clipboardStrategyType}' was initialized.`),Promise.resolve(this)),e=>(s().ULS.traceTag(596453008,n.LogCategory.msoulscat_ES_EWAJS,w(e)?n.TraceLevel.Info:n.TraceLevel.Error,`Failed to initialize clipboard strategy type '${this.clipboardStrategyType}'. Error: ${n.utils.getStringifiedError(e)}`),Promise.reject(e)))}set(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.clipboardStorage){const e="ClipboardStrategyBase.set: this.clipboardStorage should be defined";return s().ULS.shipAssertTag(596121485,n.LogCategory.msoulscat_ES_EWAJS,!1,e),Promise.reject(new U(f.ClipboardStrategyNotInitialized))}return this.clipboardDataProcessor&&this.clipboardDataProcessor.preSetProcess(e),this.clipboardStorage.set(e,t)}catch(e){return Promise.reject(new U(f.SetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).set`,e))}}get(e){try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.clipboardStorage){const e="ClipboardStrategyBase.get: this.clipboardStorage should be defined";return s().ULS.shipAssertTag(596121486,n.LogCategory.msoulscat_ES_EWAJS,!1,e),Promise.reject(new U(f.ClipboardStrategyNotInitialized))}return this.clipboardStorage.get(e).then(e=>(this.clipboardDataProcessor&&this.clipboardDataProcessor.postGetProcess(e),Promise.resolve(e))).catch(t=>{throw s().ULS.traceTag(507848131,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`ClipboardStrategyBase.get - Failed to get clipboard items. Command id: ${e.id}, Error: ${n.utils.getStringifiedError(t)}`),t})}catch(e){return Promise.reject(new U(f.GetClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).get`,e))}}onSystemClipboardChangedExternally(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.clipboardStorage?this.clipboardCapabilities.systemClipboard?Promise.resolve():this.clipboardStorage.set(Le(),e):(s().ULS.shipAssertTag(595882508,n.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.clipboardStorage should be defined"),Promise.reject(new U(f.ClipboardStrategyNotInitialized)))}catch(e){return Promise.reject(new U(f.ClearClipboardItems,`Failed in (clipboard ${this.clipboardStrategyType}).onSystemClipboardChangedExternally`,e))}}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.clipboardStorage&&this.clipboardStorage.dispose(),this.disposableImplementationExtension.dispose())}constructor(e,t,r){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.clipboardDataProcessor=r,this.disposableImplementationExtension=yt(""+e)}}const bt=!!window.performance&&!!window.performance.now&&!!window.performance.timing;function wt(e){let t=e;return t&&0!==t.trim().length||(t=ct()),new Tt(t)}function Et(){return bt?window.performance.now():Date.now()}function Lt(e){return bt?new Date(e+window.performance.timing.navigationStart):new Date(e)}function Pt(e,t,r){if(!r)throw new T(l,"creationTimestamp");return`${e?"Fulfilled":"Still unfulfilled"} after ${e?t?t-r:"?":Et()-r}ms`}class Tt{fulfilled(){return this.isFulfilled}resolve(e){this.markAsFulfilled("resolve"),this.internalResolve?this.internalResolve(e):s().ULS.traceTag(596456257,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`Deferred promise - resolve: the resolve for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}reject(e){this.markAsFulfilled("reject"),this.internalReject?this.internalReject(e):s().ULS.traceTag(596456260,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`Deferred promise - reject: the reject for deferred promise #${this.sequenceId} with id '${this.id}' is not tracked with a callback`)}markAsFulfilled(e){this.fulfillmentCheck(e)||(this.isFulfilled=!0,this.rejected="resolve"!==e,this.fulfillmentTimestamp=Et(),s().ULS.traceTag(596456261,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise: marking promise #${this.sequenceId} with id '${this.id}' as fulfilled (${this.rejected?"rejected":"resolved"}). ${Pt(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`))}fulfillmentCheck(e){return s().ULS.traceTag(596456258,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise: asked to ${e} deferred promise #${this.sequenceId} with id '${this.id}'`),this.isFulfilled&&s().ULS.traceTag(596456259,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`Deferred promise: cannot ${e} deferred promise #${this.sequenceId} with id '${this.id}' since it was ${this.rejected?"rejected":"resolved"} already on ${Lt(this.fulfillmentTimestamp)}. ${Pt(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)}`),this.isFulfilled}constructor(e){this.isFulfilled=!1,this.fulfillmentTimestamp=void 0,this.rejected=!1,this.id=dt(e),Tt.sequenceId+=1,this.sequenceId=Tt.sequenceId,this.creationTimestamp=Et(),s().ULS.traceTag(596456225,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise: creating deferred promise #${this.sequenceId} with id '${this.id}' on ${Lt(this.creationTimestamp)}`),this.promise=new Promise((e,t)=>{s().ULS.traceTag(596456226,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise: registering callback for promise #${this.sequenceId} with id '${this.id}' on ${Lt(Et())}`),this.internalResolve=e,this.internalReject=t})}}function vt(){return new It}Tt.sequenceId=0;class It{getDeferredPromise(e){const t=dt(e);return this.deferredResultMessagePromiseCache[t]}getPromise(e){const t=this.getDeferredPromise(e);if(t)return s().ULS.traceTag(596456218,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: found a deferred promise with id '${e}'.`),t.promise;s().ULS.traceTag(596456219,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: there is no deferred promise with id '${e}'.`)}addNewPromise(e){const t=wt(e);if(this.getDeferredPromise(t.id))throw new v("A deferred promise already exists in the cache for the specified id","id",t.id);const r=dt(t.id);return this.deferredResultMessagePromiseCache[r]=t,s().ULS.traceTag(596456220,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: added a new deferred promise with id '${t.id}'.`),t}getLength(){let e=0;for(const t in this.deferredResultMessagePromiseCache)e+=1;return e}delete(e){if(!this.getDeferredPromise(e))return void s().ULS.traceTag(596456221,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: no need to delete an item with id '${e}' since this id is not associated with an existing deferred promise.`);const t=dt(e);delete this.deferredResultMessagePromiseCache[t],s().ULS.traceTag(596456222,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: deleted id '${e}'.`)}clear(){if(s().ULS.traceTag(596456223,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Deferred promise cache: clearing ${this.getLength()} items from the cache`),this.deferredResultMessagePromiseCache)for(const e in this.deferredResultMessagePromiseCache){const t=this.deferredResultMessagePromiseCache[e];if(t)try{t.reject()}catch(t){s().ULS.traceTag(596456224,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`Deferred promise cache: clear failed to reject promise id '${e}' with this exception: ${t.message}. Ignoring.`)}}this.deferredResultMessagePromiseCache={}}constructor(){this.deferredResultMessagePromiseCache={}}}function _t(e){if(!e)throw new T(l,"validator");return{deserialize:t=>function(e,t){if(!e)throw new T(l,"incomingMessage");if(!t)throw new T(l,"validator");if(0===e.length)throw new v("An empty message is invalid","incomingMessage");const r=e.trim();if(0===r.length)throw new v("A message cannot contain only spaces","incomingMessage");let o;try{o=JSON.parse(r)}catch(t){throw new v("Deserialization failed","incomingMessage",`Contains ${e.length.toString()} characters`,t)}if(!o)throw new v("Deserialization returned nothing","incomingMessage");return t(o),o}(t,e)}}function At(e){if(!e)throw new T(l,"validator");return{serialize:t=>function(e,t){if(!e)throw new T(l,"outgoingMessage");if(!t)throw new T(l,"validator");return t(e),function(e){let t;try{t=JSON.stringify(e)}catch(t){throw new v("Serialization failed","outgoingMessage",Object.keys(e).length+" properties",t)}return s().ULS.traceTag(596452375,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"The length of the serialized message is "+t.length),t}(e)}(t,e)}}const xt="initmessageid",Ft="unknownmessageid",Mt="CreatorOrigin";function Wt(e){if(!e)throw new T(l,"remoteWindow");if(!("window"in e)||!e.window)throw new T(l,"remoteWindow.window");if(!("windowOrigin"in e)||!e.windowOrigin)throw new T(l,"remoteWindow.windowOrigin");const t=et(e.windowOrigin);return{window:e.window,windowOrigin:t}}class Ot{get disposableImplementationExtension(){return this._disposableImplementationExtension}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(H([()=>{this.sender&&this.sender.dispose()},()=>{this.receiver&&this.receiver.dispose()}]),this.disposableImplementationExtension.dispose())}postMessage(e){if(this.disposableImplementationExtension.throwIfDisposed("postMessage"),!e)throw new T(l,"outgoingMessage");if(!this.sender){const e="WindowRPCBase::postMessage - this.sender should be defined";throw s().ULS.shipAssertTag(596121484,n.LogCategory.msoulscat_ES_EWAJS,!1,e),new I(e)}this.sender.postMessage(e)}constructor(e,t,r,o){this.serializer=e,this.deserializer=t,this.remoteWindow=r,this.remoteWindow=r,this._disposableImplementationExtension=yt(o)}}function jt(){return Dt}const Dt={addEventListener:(e,t)=>window.addEventListener(e,t),removeEventListener:(e,t)=>window.removeEventListener(e,t)};function $t(e,t,r){return new Jt(e,t,r)}function Ut(e,t,r){return new Jt(e,t,r)}class Jt{dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||(jt().removeEventListener("message",this.windowMessageHandler),this.disposableImplementationExtension.dispose())}shouldFilterMessageEvent(e){try{if(!e.origin||!e.source)return s().ULS.traceTag(596452370,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"Window RPC Receiver: ignoring messages from unspecified window sources."),!0;if(e.source===window)return s().ULS.traceTag(596452371,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from this window to itself."),!0;if(this.remoteWindow.window&&e.source!==this.remoteWindow.window)return s().ULS.traceTag(596452372,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows other than the assigned remote window."),!0;if(e.origin.toLowerCase()!==this.remoteWindow.windowOrigin)return s().ULS.traceTag(596452373,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows with an origin that differs from remote window origin."),!0}catch(e){return!0}return!1}onMessageReceived(e){if(this.shouldFilterMessageEvent(e))return;let t=void 0;try{t=this.deserializer.deserialize(e.data)}catch(e){s().ULS.traceTag(596452374,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"Window RPC Receiver: unable to deserialize incoming message. "+n.utils.getStringifiedError(e));try{this.handler.handleDeserializationError(e)}catch(e){s().ULS.traceTag(596452184,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"Window RPC Receiver: unable to handle deserialization error. "+n.utils.getStringifiedError(e))}return}if(t)try{this.handler.handleMessage(t).catch(e=>{s().ULS.traceTag(595985880,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+n.utils.getStringifiedError(e))})}catch(e){s().ULS.traceTag(596452186,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+n.utils.getStringifiedError(e))}else s().ULS.traceTag(596452185,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"Window RPC Receiver: the incoming message is empty")}constructor(e,t,r){if(this.deserializer=e,this.handler=t,this.windowMessageHandler=e=>this.onMessageReceived(e),!e)throw new T(l,"deserializer");if(!t)throw new T(l,"handler");if(!r)throw new T(l,"windowRPC");this.disposableImplementationExtension=yt("WindowRPCReceiverInternal"),this.remoteWindow=Wt(r.remoteWindow),jt().addEventListener("message",this.windowMessageHandler)}}function Ht(e,t){return new Nt(e,t)}function Rt(e,t){return new Nt(e,t)}class Nt{postMessage(e){if(!e)throw new T(l,"outgoingMessage");if(!this.remoteWindow.window)throw new I("Configure the remote window");if(!this.remoteWindow.window.postMessage)throw new I("The remote window does not support postMessage");const t=this.serializer.serialize(e);Y().postMessage(this.remoteWindow.window,t,this.remoteWindow.windowOrigin)}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e,t,r=!1){if(this.serializer=e,this.delayedQueueEnabled=r,!e)throw new T(l,"serializer");if(!t)throw new T(l,"windowRPC");this.disposableImplementationExtension=yt("WindowRPCSenderInternal"),this.remoteWindow=Wt(t.remoteWindow)}}const kt="_LocalStorageChangedFlag";function zt(){try{const e="XLO_CCP",t="1";return localStorage.setItem(e,t),localStorage.getItem(e)===t}catch(e){return!1}}function Vt(e){return"OfficeOnlineCCP_Data_"+e}function Bt(e){return"OfficeOnlineCCP_Metadata_"+e}function Kt(e){return Bt(e)+kt}class Gt{constructor(){this.copyStatus=Xt.Started,this.isTimestampStoredInSystemClipboard=!1,this.isAsyncSerializeFailed=!1,this.succeededPopulatingSystemClipboardSync=void 0,this.succeededPopulatingSystemClipboardAsync=void 0,this.isFullSheetCopy=!1}}class qt{profilingMessage(e){const t=n.perfWatch.timeStamp()-this.startTime;return`onPasteProfiling: ${e}, pasteId: ${this.id}, timeMS: ${t.toFixed()}`}constructor(){this.startTime=n.perfWatch.timeStamp()}}var Xt;function Qt(){return{}}function Yt(e){let t=void 0;return e&&e.lastCopy&&(t=_object_spread({},e.lastCopy)),{lastCopy:t}}function Zt(e){try{s().ULS.traceTag(595716237,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Attempting to create clipboard storage type '${Me.LocalStorage}'`);const t=new er(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}}!function(e){e[e.Started=1]="Started",e[e.SynchronousPhaseCompleted=2]="SynchronousPhaseCompleted",e[e.Completed=3]="Completed"}(Xt||(Xt={}));class er{get(e){this.disposableImplementationExtension.throwIfDisposed("get"),s().ULS.traceTag(595716238,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`localStorageClipboardStorage.get: commandParameters.id='${e?e.id:l}'`);const t=localStorage.getItem(this.localStorageKey);if(!t)return Promise.resolve(Le());try{const e=JSON.parse(t);if(!e||0===Pe(e))return Promise.resolve(Le());const r=ve(e);return Promise.resolve(r)}catch(e){return Promise.resolve(Le())}}set(e,t){this.disposableImplementationExtension.throwIfDisposed("set"),s().ULS.traceTag(595716239,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`localStorageClipboardStorage.set: item count=${Te(e)}'; commandParameters.id='${t?t.id:l}'`),0===Te(e)?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,JSON.stringify(e.getData()));const r=""+(this.localStorageKey+kt),o=ct();return s().ULS.traceTag(595654546,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`localStorageClipboardStorage.set: set local storage value. eventFalgKey = ${r}. eventFlagValue = ${o}`),localStorage.setItem(r,o),Promise.resolve()}getSupportedDataFormats(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),[se,le,"data/shadow-workbook"]}dispose(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()}constructor(e){this.localStorageKey=e;try{if(!localStorage)throw new Error("LocalStorageClipboardStorage.ctor: localStorage == null")}catch(e){throw new U(f.LocalStorageInitilizationInaccessible,"LocalStorageClipboardStorage.ctor: failed access to localStorage",e)}if(!e)throw new U(f.LocalStorageInitilizationNoKey,"LocalStorageClipboardStorage.ctor: localStorageKey must be defined");this.clipboardStorageType=Me.LocalStorage,this.disposableImplementationExtension=yt("LocalStorageClipboardStorage")}}function tr(e){return s().ULS.traceTag(595716236,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`Attempting to create clipboard strategy type '${m.LocalStorage}' with localStorageKey: '${e}'`),(new rr).initialize(Zt(e))}class rr extends St{constructor(e){super(m.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},e)}}class or{onStorageChanged(e){s().ULS.shipAssertTag(595716249,n.LogCategory.msoulscat_ES_EWAJS,null!=e,"e should not be null"),s().ULS.traceTag(595716288,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`LocalStorageKeyChangeTracker.onStorageChanged:got storage change event. e.key = ${e.key}. localStorageKeyToWatch = ${this.localStorageKeyToWatch}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),e.key===this.localStorageKeyToWatch&&(this.raiseMetadataChangedEvent(),s().ULS.traceTag(595716289,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"LocalStorageKeyChangeTracker.onStorageChanged: raised metadata change event. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged()||this.waitForLocalStorageValueToChange(this.maxTimeToWaitInMilliseconds).then(()=>{this.raiseMetadataChangedEvent()},()=>{s().ULS.traceTag(595716295,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"LocalStorageKeyChangeTracker.onStorageChanged: got rejected promise.")}))}raiseMetadataChangedEvent(){return s().ULS.traceTag(595715525,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: starting raiseMetadataChangedEvent. lastLocalStorageValue = "+this.lastLocalStorageValue),this.clipboardStrategy.get({userHash:0}).then(e=>{this.listener(e),s().ULS.traceTag(595716232,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: sent message. lastLocalStorageValue = "+this.lastLocalStorageValue)},e=>{s().ULS.traceTag(595716233,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: failed to get metadata from clipboardStorage")})}isLocalStorageValueChanged(){const e=localStorage.getItem(this.localStorageKeyToWatch),t=this.lastLocalStorageValue!==e;return s().ULS.traceTag(595715526,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`LocalStorageKeyChangeTracker.isLocalStorageValueChanged: lastLocalStorageValue = ${this.lastLocalStorageValue}. currentLocalStorageValue = ${e}`),this.lastLocalStorageValue=e,t}waitForLocalStorageValueToChange(e){if(s().ULS.traceTag(595715527,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: start waitForLocalStorageValueToChange. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged())return s().ULS.traceTag(595715528,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving because value was changed. lastLocalStorageValue = "+this.lastLocalStorageValue),Promise.resolve();const t=wt(),r=new Date,o=setInterval(()=>{const a=(new Date).getTime()-r.getTime();s().ULS.traceTag(595715529,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: call by setInterval. startTime = ${r}. elapseTime = ${a}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),this.isLocalStorageValueChanged()?(clearInterval(o),s().ULS.traceTag(595716234,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving. startTime = ${r}. elapseTime = ${a}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.resolve()):a>e&&(clearInterval(o),s().ULS.traceTag(595716235,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: rejecting. startTime = ${r}. elapseTime = ${a}. lastLocalStorageValue = ${this.lastLocalStorageValue}`),t.reject())},200);return t.promise}constructor(e,t,r){this.localStorageKeyToWatch=e,this.clipboardStrategy=t,this.listener=r,this.maxTimeToWaitInMilliseconds=2e3,this.lastLocalStorageValue=null,window.addEventListener("storage",this.onStorageChanged.bind(this)),this.raiseMetadataChangedEvent()}}const ar=new RegExp("(\n\r)|(\r\n)|(\r)","g"),nr=new RegExp("(\t)","g"),ir=new RegExp("<","g"),sr=new RegExp(">","g"),cr="div",lr="pre",dr="table",ur="tr",pr="td",gr="\x3c!--StartFragment--\x3e".length,mr="\x3c!--EndFragment--\x3e".length,fr="Version:0.9\nStartHTML:0000000100\nEndHTML:{EndHTML0}\nStartFragment:0000000134\nEndFragment:{EndFragm}\n<html>\n<body>\n\x3c!--StartFragment--\x3e\n",hr="</html>".length,Cr="data-ccp-timestamp",yr=0;function Sr(e){return e?e.replace(ar,"\n"):e}function br(e){return e?e.length<=10240?e:e.substr(0,10240):l}function wr(e){var t;const r=function(e){return e?e.replace(ar,`</${pr}></${ur}><${ur}><${pr}>`):e}((t=xr(e))?t.replace(nr,`</${pr}><${pr}>`):t);return`<${dr}><${ur}><${pr}>${r}</${pr}></${ur}></${dr}>`}function Er(e,t,r){if(r!==yr&&!r)throw new T(l,"timestamp");if(isNaN(r))throw new v(l,"timestamp",r.toString());return vr(function(e,t,r){return`<${e} ${Cr}='${r}'>${t}</${e}>`}(e,wr(t),r))}function Lr(e){const t=[],r=e.getElementsByTagName("tr");if(r.length>0){const e=Pr(r[0]);t.push(e);for(let e=1;e<r.length;e+=1){t.push("\r"),t.push("\n");const o=Pr(r[e]);t.push(o)}}return t.join("")}function Pr(e){const t=[],r=e.getElementsByTagName("td");if(r.length>0){t.push(r[0].innerText);for(let e=1;e<r.length;e+=1)t.push("\t"),t.push(r[e].innerText)}return t.join("")}function Tr(e){return!!(e&&e.firstChild&&e.firstElementChild)&&!!e.firstElementChild.getAttribute(Cr)}function vr(e){if(!G()||X())return e;const t="0000000000".length,r=fr.length+e.length+"\x3c!--EndFragment--\x3e\n</body>\n</html>".length;let o=(r-"\x3c!--EndFragment--\x3e\n</body>\n</html>".length).toString();if(o.length<t&&(o="0000000000".substr(0,t-o.length)+o),o.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Fragment xml comment is ${o.length} but it should be ${t}`;throw s().ULS.shipAssertTag(596128536,n.LogCategory.msoulscat_ES_EWAJS,!1,e),new U(f.UnexpectedClipboardTextHtmlContentLength,e)}let a=(r-hr).toString();if(a.length<t&&(a="0000000000".substr(0,t-a.length)+a),a.length!==t){const e=`addClipboardWrapperForEdge: the string representation of the opening bracket position of the End Html tag is ${a.length} but it should be ${t}`;throw s().ULS.shipAssertTag(596128537,n.LogCategory.msoulscat_ES_EWAJS,!1,e),new U(f.UnexpectedClipboardTextHtmlContentLength,e)}const i=fr.replace("{EndHTML0}",a).replace("{EndFragm}",o)+e+"\x3c!--EndFragment--\x3e\n</body>\n</html>";return s().ULS.shipAssertTag(596128538,n.LogCategory.msoulscat_ES_EWAJS,i.length===r,`addClipboardWrapperForEdge: The resulting text/html payload length of ${i.length} differs from the expected length of ${r}`),i}function Ir(e){if(!e)return l;if(!e.trim())return e;const t=e.indexOf("\x3c!--StartFragment--\x3e"),r=e.indexOf("\x3c!--EndFragment--\x3e");if(t<0||r<0||t>r)return e;const o=t+gr,a=r-o,n=e.indexOf("\x3c!--StartFragment--\x3e",o),i=e.indexOf("\x3c!--EndFragment--\x3e",r+mr);return n>=0||i>=0?e:e.substr(o,a)}function _r(e){const t=function(e,t){if(!e||!e.trim())return;if(!t||!t.trim())throw new T(l,"attributeName");const r=new RegExp(t+"=['\"](\\d+)['\"]","i").exec(e);return!r||r.length<2?void 0:r[1]}(e,Cr);if(!t||!t.trim())return;const r=Number(t);return!r&&r!==yr||isNaN(r)?void 0:r}function Ar(e){if(!e||!e.trim())return;const t=(new DOMParser).parseFromString(e,"text/html"),r=function(e){const t=e.getElementsByTagName("meta");for(let e=0;e<t.length;e+=1){const r=t[e];if("ProgId"===r.getAttribute("name")){const e=r.getAttribute("content");if(null!==e){if(e.length>64)return void s().ULS.shipAssertTag(595683460,n.LogCategory.msoulscat_ES_EWAJS,!1,"ProgID longer than 64 characters");if(e.startsWith("Word"))return"Word Desktop";if(e.startsWith("Excel"))return"Excel Desktop";if(e.startsWith("PowerPoint"))return"PowerPoint Desktop";if(e.startsWith("OneNote"))return"OneNote Desktop";s().ULS.traceTag(595683457,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"htmlClipboardItem.getOfficeDesktopOrigin: unrecognized ProgId content")}return}}}(t);if(void 0!==r)return r;const o=function(e){if(null===e||null===e.body||null===e.body.children||0===e.body.children.length)return;const t=e.body.children[0];if(null!=t&&null!=t.classList)for(let e=0;e<t.classList.length;e+=1){const r=t.classList[e];if(r.startsWith("SCXO"))return"OneNote Online";if(r.startsWith("SCXP"))return"PowerPoint Online";if(r.startsWith("SCXW"))return"Word Online"}}(t);return void 0!==o?o:function(e){if(null===e)return!1;const t=e.getElementsByTagName("b");if(0===t.length)return!1;const r=t[0];return!(null==r||null==r.id||null==r.id.startsWith||!r.id.startsWith("docs-internal-guid-"))}(t)?"Google Docs":void 0}function xr(e){return e?e.replace(ir,"&lt;").replace(sr,"&gt;"):l}function Fr(e,t,r){let o="";return r&&(o=Object.keys(r).reduce((e,t)=>t?`${e} ${t}='${r[t]}'`:e,"")),`<${t}${o}>${e}</${t}>`}},10:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initStopwatchFactory=void 0;let o=()=>Date.now();t.initStopwatchFactory=function(e,t=1){return"undefined"!=typeof self&&self.performance&&self.performance.now&&(o=()=>self.performance.now()),function(r){let a=o(),n=r;return{reset(e){null!=e&&(n=e),a=o()},stop(r){const i=o()-a,s=JSON.stringify({Target:n,Duration:i.toFixed(t),StopInfo:r});e(s)}}}}},11:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryCollector=void 0,t.TelemetryCollector=class{getJsonForLogging(){return'{"Events":'+this.getEventsLoggableString()+',"Counters":'+this.getCountersLoggableString()+',"Timers":'+this.getTimersLoggableString()+"}"}addEvent(e,t){null!=e&&null!=t&&(this.events[e]=t)}clearEvents(){this.events={}}getEventsLoggableString(){return JSON.stringify(this.events)}incrementCounter(e){null!=e&&(this.counters.hasOwnProperty(e)?this.counters[e]+=1:this.counters[e]=1)}getCountersLoggableString(){return JSON.stringify(this.counters)}clearCounters(){this.counters={}}startTimer(e){null!=e&&(this.timers[e]={name:e,startTime:Date.now(),endTime:void 0,isRunning:!0,duration:void 0})}endTimer(e){null!=e&&this.timers.hasOwnProperty(e)&&(this.timers[e].endTime=Date.now(),this.timers[e].isRunning=!1,this.timers[e].duration=this.timers[e].endTime-this.timers[e].startTime)}getTimerDuration(e){return null==e?"-1":this.timers.hasOwnProperty(e)&&void 0!==this.timers[e].duration?this.timers[e].duration:"-1"}getTimersLoggableString(){return JSON.stringify(this.timers)}constructor(){this.counters={},this.timers={},this.events={}}}},12:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewGuid=void 0,t.getNewGuid=function(){const e=new Uint8Array(31),t=function(e){const t={crypto:!1,perfNow:!1,exceptions:[]},r="undefined"!=typeof crypto?crypto:"undefined"!=typeof msCrypto?msCrypto:void 0;if(r){t.crypto=!0;try{return r.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+JSON.stringify(e))}}let o=!1;const a="undefined"!=typeof performance?performance:void 0;try{a&&a.now&&a.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+JSON.stringify(e))}for(let r=0;r<e.length;r+=1){try{if(o){t.perfNow=!0;let e=Math.floor(100*a.now())%10;(e<0||e>9)&&(e=0);for(let t=0;t<e;t+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+JSON.stringify(e))}e[r]=Math.floor(16*Math.random())}return t}(e);let r=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=15&e[r];return r+=1,("x"===t?o:3&o|8).toString(16)}),t]}},13:function(e,t,r){"use strict";var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaInputMode=t.TextAreaVirtualKeyboardPolicy=void 0,function(e){e.Auto="auto",e.Manual="manual"}(o||(t.TextAreaVirtualKeyboardPolicy=o={})),function(e){e.None="none",e.Text="text",e.Tel="tel",e.Url="url",e.Email="email",e.Numeric="numeric",e.Decimal="decimal",e.Search="search"}(a||(t.TextAreaInputMode=a={}))},14:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReplaceChildrenSupported=t.replaceChildren=void 0,t.replaceChildren=e=>{if(e)if((0,t.isReplaceChildrenSupported)(e))e.replaceChildren();else for(;e.lastChild;)e.removeChild(e.lastChild)},t.isReplaceChildrenSupported=e=>!!e.replaceChildren},2:function(e,t,r){"use strict";var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.NulLogger=t.ConsoleLogger=t.ULS=t.LogCategory=t.TraceLevel=void 0,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(t.TraceLevel=o={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS"}(a||(t.LogCategory=a={})),t.ULS={getFromExternalLogger:function(e){const t=e;return{ULS:{trace:(e,r,o)=>t.traceTag(0,e,r,o),traceTag:(e,r,o,a)=>t.traceTag(e,r,o,a),debugTrace:(e,r,o)=>t.debugTraceTag(0,e,r,o),debugTraceTag:(e,r,o,a)=>t.debugTraceTag(e,r,o,a),assert:(e,r,o)=>t.assertTag(0,e,r,o),assertTag:(e,r,o,a)=>t.assertTag(e,r,o,a),shipAssert:(e,r,o)=>t.shipAssertTag(0,e,r,o),shipAssertTag:(e,r,o,a)=>t.shipAssertTag(e,r,o,a),dnmTrace:(e,r,o)=>t.dnmTraceTag(0,e,r,o),dnmTraceTag:(e,r,o,a)=>t.dnmTraceTag(e,r,o,a)}}}},t.ConsoleLogger=class{shipAssertTag(e,t,r,o){console.assert(r,"shipAssertTag:",e,t,o)}assertTag(e,t,r,o){console.assert(r,"assertTag",e,t,o)}traceTag(e,t,r,o){console.log("traceTag",e,o,t,r)}dnmTraceTag(e,t,r,o){console.log("dnmTraceTag",e,o,t,r)}debugTraceTag(e,t,r,o){console.log("debugTraceTag",e,o,t,r)}},t.NulLogger=class{shipAssertTag(){}assertTag(){}traceTag(){}debugTraceTag(){}dnmTraceTag(){}}},3:function(e,t,r){"use strict";let o;r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return n}));const a=e=>{o=e},n=(e,t=!1)=>o?o.getBooleanFeatureGate(e,t):t},5:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calcHashCode=t.decodeHtml=t.getQueryParameterByName=t.chainFallbackPromises=t.retry=t.getPerfWatchMarkName=t.getStringifiedError=t.defaultToJSONResultWhenStringifyFails=t.forEachPromise=void 0,t.forEachPromise=function(e,t,r){return e.reduce((e,o)=>e.then(()=>r&&r.stop?Promise.resolve(void 0):t(o,r)),Promise.resolve(void 0))},t.defaultToJSONResultWhenStringifyFails="...",t.getStringifiedError=function(e){if(0===e)return"0";if(!e)return"";try{return JSON.stringify(function e(t,r=0){if(r<0||r>5)return t;if(null==t||"object"!=typeof t)return t;const o={};Object.getOwnPropertyNames(t).forEach(e=>{"stack"!==e&&e.toUpperCase()!==e&&(o[e]=t[e])});const a=Object.getPrototypeOf(t);a&&"object"==typeof a&&Object.keys(a).forEach(e=>{"stack"!==e&&e.toUpperCase()!==e&&(o[e]=t[e])});const n={};return Object.keys(o).forEach(t=>{n[t]=e(o[t],r+1)}),n}(e))}catch(e){return t.defaultToJSONResultWhenStringifyFails}};const o=new RegExp("\\W+","g");t.getPerfWatchMarkName=function(e){if(!e)return"";let t=e.trim().substring(0,200).trim().replace(o,"_").substring(0,80);return t&&t.length>0&&"_"===t.substr(t.length-1,1)&&(t=t.substr(0,t.length-1)),t&&t.length>0&&"_"===t.substr(0,1)&&(t=t.substr(1)),t},t.retry=function(e,t){if(!e)return Promise.reject(new Error("utils.retry: action can't be null or undefined"));if(t<1)return Promise.reject(new Error("utils.retry: attempts expected to be greater than 0 but got "+t));let r=Promise.reject();for(let o=1;o<=t;o+=1)r=r.catch(t=>e(o,t));return r},t.chainFallbackPromises=function(e,t){if(!e||0===e.length)return Promise.reject();let r=t(e[0]);for(let o=1;o<e.length;o+=1){const a=e[o];r=r.catch(()=>t(a))}return r},t.getQueryParameterByName=function(e,t){const r=new RegExp(`[?&]${t}(=([^&#]*)|&|#|$)`).exec(e);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""},t.decodeHtml=function(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/html").documentElement.textContent:e},t.calcHashCode=function(e){if(!e)return 0;let t=5381,r=t;const o=e.length;for(let a=0;a<o&&(t=4294967295&((t<<5)+t^e.charCodeAt(a)),a!==o-1);a+=2)r=4294967295&((r<<5)+r^e.charCodeAt(a+1));let a=t+35685*r+(23896*r<<16)&4294967295;return a<0&&(a+=4294967296),a}},50:function(e,t,r){"use strict";r.r(t),r.d(t,"ulsLogger",(function(){return a.mc})),r.d(t,"initLogger",(function(){return a.Eb})),r.d(t,"isClipboardPlatformErrorType",(function(){return a.Hb})),r.d(t,"isClipboardPlatformErrorTypes",(function(){return a.Ib})),r.d(t,"isLocalStorageInaccessible",(function(){return a.Nb})),r.d(t,"BaseError",(function(){return a.a})),r.d(t,"NoValidKeyError",(function(){return a.D})),r.d(t,"MissingArgumentError",(function(){return a.B})),r.d(t,"InvalidArgumentError",(function(){return a.t})),r.d(t,"InvalidOperationError",(function(){return a.u})),r.d(t,"UnsupportedError",(function(){return a.M})),r.d(t,"MismatchVersionError",(function(){return a.A})),r.d(t,"TTLClipboardDataError",(function(){return a.K})),r.d(t,"UserHashMismatchError",(function(){return a.N})),r.d(t,"UnexpectedError",(function(){return a.L})),r.d(t,"CCPError",(function(){return a.b})),r.d(t,"CopyError",(function(){return a.m})),r.d(t,"PasteError",(function(){return a.H})),r.d(t,"CancelError",(function(){return a.c})),r.d(t,"ClipboardPlatformError",(function(){return a.e})),r.d(t,"SharedClipboardError",(function(){return a.J})),r.d(t,"rethrowAfterAllActions",(function(){return a.gc})),r.d(t,"init",(function(){return a.Db})),r.d(t,"isIE",(function(){return a.Mb})),r.d(t,"isEdge",(function(){return a.Jb})),r.d(t,"isEdgeWithTextHtmlClipboardSupport",(function(){return a.Lb})),r.d(t,"isEdgeVersionWithTextHtmlWrapperSupport",(function(){return a.Kb})),r.d(t,"isChromiumEdge",(function(){return a.Gb})),r.d(t,"getWindowMessaging",(function(){return a.Ab})),r.d(t,"emptyString",(function(){return a.jb})),r.d(t,"oneSpace",(function(){return a.bc})),r.d(t,"oneDot",(function(){return a.ac})),r.d(t,"metadataLastCopyWasExternal",(function(){return a.Yb})),r.d(t,"metadataLastCopyWasExternalXLOSource",(function(){return a.Zb})),r.d(t,"ClipboardStrategyType",(function(){return a.i})),r.d(t,"CopyClipboardCommand",(function(){return a.j})),r.d(t,"CutClipboardCommand",(function(){return a.p})),r.d(t,"PasteClipboardCommand",(function(){return a.E})),r.d(t,"CopyClipboardEvent",(function(){return a.k})),r.d(t,"CutClipboardEvent",(function(){return a.q})),r.d(t,"PasteClipboardEvent",(function(){return a.F})),r.d(t,"addEventListener",(function(){return a.P})),r.d(t,"defaultClipboardDataFormat",(function(){return a.hb})),r.d(t,"defaultIEClipboardDataFormat",(function(){return a.ib})),r.d(t,"textHtmlClipboardDataFormat",(function(){return a.lc})),r.d(t,"imageClipboardDataFormat",(function(){return a.Cb})),r.d(t,"shadowWorkbookClipboardDataFormat",(function(){return a.hc})),r.d(t,"shadowWorkbookClipboardWebCustomDataFormat",(function(){return a.ic})),r.d(t,"metadataIsLastCopyWasExternal",(function(){return a.Wb})),r.d(t,"metadataIsLastCopyWasExternalXLOSource",(function(){return a.Xb})),r.d(t,"metadataChromeExtensionId",(function(){return a.Rb})),r.d(t,"metadataInfraVersionFormat",(function(){return a.Vb})),r.d(t,"metadataCopyId",(function(){return a.Ub})),r.d(t,"metadataAdditionalSignatureDataAttributes",(function(){return a.Qb})),r.d(t,"metadataCopyContextClipboardDataFormat",(function(){return a.Sb})),r.d(t,"metadataCopyContextWebCustomDataFormat",(function(){return a.Tb})),r.d(t,"getEmptyClipboardItemsData",(function(){return a.qb})),r.d(t,"getImmutableEmptyClipboardItems",(function(){return a.sb})),r.d(t,"getClipboardItemsDataCount",(function(){return a.ob})),r.d(t,"getClipboardItemsCount",(function(){return a.nb})),r.d(t,"createClipboardItems",(function(){return a.R})),r.d(t,"getClipboardItemContent",(function(){return a.mb})),r.d(t,"getClipboardItem",(function(){return a.lb})),r.d(t,"getDefaultClipboardData",(function(){return a.pb})),r.d(t,"getItemsFromClipboardItems",(function(){return a.tb})),r.d(t,"ClipboardStorageType",(function(){return a.g})),r.d(t,"CutCopyPasteFlags",(function(){return a.r})),r.d(t,"ClipboardPlatformErrorTypes",(function(){return a.f})),r.d(t,"CopyErrorTypes",(function(){return a.n})),r.d(t,"PasteErrorTypes",(function(){return a.I})),r.d(t,"CancelErrorTypes",(function(){return a.d})),r.d(t,"InfraInitializationErrorTypes",(function(){return a.s})),r.d(t,"getSharedClipboardValidatedOrigin",(function(){return a.xb})),r.d(t,"validateRemoteWindowOrigin",(function(){return a.qc})),r.d(t,"NoUserHash",(function(){return a.C})),r.d(t,"shouldClearClipboard",(function(){return a.kc})),r.d(t,"createMessageId",(function(){return a.bb})),r.d(t,"createContextId",(function(){return a.U})),r.d(t,"getCanonicalValidatedMessageId",(function(){return a.kb})),r.d(t,"createClipboardOperationMessage",(function(){return a.S})),r.d(t,"MessageDestinationConst",(function(){return a.z})),r.d(t,"isValidClipboardOperationCode",(function(){return a.Pb})),r.d(t,"validateClipboardOperationMessage",(function(){return a.oc})),r.d(t,"createClipboardOperationResultMessage",(function(){return a.T})),r.d(t,"validateClipboardOperationResultMessage",(function(){return a.pc})),r.d(t,"ClipboardStrategyBase",(function(){return a.h})),r.d(t,"createDeferredPromise",(function(){return a.V})),r.d(t,"createDeferredPromiseCache",(function(){return a.W})),r.d(t,"createDisposableImplementationExtension",(function(){return a.X})),r.d(t,"createMessageDeserializer",(function(){return a.ab})),r.d(t,"createMessageSerializer",(function(){return a.cb})),r.d(t,"initMessageIdPrefix",(function(){return a.Fb})),r.d(t,"unknownMessageId",(function(){return a.nc})),r.d(t,"queryStringCreatorOriginParameter",(function(){return a.dc})),r.d(t,"getValidatedRemoteWindow",(function(){return a.yb})),r.d(t,"WindowRPCBase",(function(){return a.O})),r.d(t,"createWindowRPCServerReceiver",(function(){return a.fb})),r.d(t,"createWindowRPCClientReceiver",(function(){return a.db})),r.d(t,"createWindowRPCServerSender",(function(){return a.gb})),r.d(t,"createWindowRPCClientSender",(function(){return a.eb})),r.d(t,"LocalStorageChangedEventFlagPostfix",(function(){return a.v})),r.d(t,"isLocalStorageSupported",(function(){return a.Ob})),r.d(t,"getLocalStorageDataKey",(function(){return a.ub})),r.d(t,"getLocalStorageMetadataKey",(function(){return a.vb})),r.d(t,"getLocalStorageMetadataKeyToWatch",(function(){return a.wb})),r.d(t,"CopyContext",(function(){return a.l})),r.d(t,"PasteContext",(function(){return a.G})),r.d(t,"CopyStatus",(function(){return a.o})),r.d(t,"getEmptyMetadata",(function(){return a.rb})),r.d(t,"cloneMetadata",(function(){return a.Q})),r.d(t,"getWindowLocation",(function(){return a.zb})),r.d(t,"createLocalStorageClipboardStrategy",(function(){return a.Z})),r.d(t,"LocalStorageClipboardStrategy",(function(){return a.x})),r.d(t,"createLocalStorageClipboardStorage",(function(){return a.Y})),r.d(t,"LocalStorageClipboardStorage",(function(){return a.w})),r.d(t,"LocalStorageKeyChangeTracker",(function(){return a.y})),r.d(t,"queryStringBulsEndpointUrlParameter",(function(){return a.cc})),r.d(t,"queryStringSessionIdParameter",(function(){return a.ec})),r.d(t,"queryStringWacClusterParameter",(function(){return a.fc})),r.d(t,"htmlClipboardItem",(function(){return a.Bb})),r.d(t,"sharedClipboardSettings",(function(){return a.jc})),r.d(t,"createCopyPasteInfra",(function(){return i})),r.d(t,"getStringifiedError",(function(){return c.getStringifiedError})),r.d(t,"setCopyPasteInfraFeatureGateManager",(function(){return l}));var o=r(3),a=r(1),n=r(0);function i(e,t,r){return new s(e,t,r)}class s{get clipboardStrategy(){if(this.clipboardPlatformEnvironment)return this.clipboardPlatformEnvironment.getClipboardStrategy();throw new a.u("clipboardPlatformEnvironment is missing")}onCopy(e){if(!e)return Promise.reject(new a.m(a.n.MissingArgumentError,"Missing commandParameters argument",new a.B(a.jb,"commandParameters")));let t,r;t=new a.l;try{t.id=Object(a.U)(),Object(a.mc)().ULS.traceTag(595937123,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopy: copy ${t.id} started.`),t.sessionId=this.applicationHost.getSessionId(),t.commandParameters=e;const o=this.getCopyFlowHandler(t);t.sourceItem=this.getSourceItem(o,t),this.clearInProgressCopyIfNeeded(t),this.inProgressCopyContext=t,r=this.serialize(o,t),Object(a.mc)().ULS.traceTag(595937152,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Verbose,`CopyPasteFlowManager.onCopy: updating metadata for copy id ${t.id} after serialize.`),this.isLocalstorageDepsInAsyncClipboardAPIRemoved&&r&&r.synchronousResult&&r.synchronousResult.setItem(a.Sb,this.metadataManager.serializeMetadata({lastCopy:_object_spread_props(_object_spread({},t),{copyStatus:t.isFromCache?a.o.Completed:a.o.SynchronousPhaseCompleted})})),this.metadataManager.updateMetadata({lastCopy:t})}catch(r){return t?Object(a.mc)().ULS.traceTag(595734742,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopy: catching error for copy id ${t.id} during serialize.`):Object(a.mc)().ULS.traceTag(595734743,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.onCopy: catching error and no copy context during serialize."),this.copyCompleteCleanup(t,e),Promise.reject(r)}try{return Promise.all([this.setClipboardSync(r.synchronousResult,e,t).then(()=>this.rejectIfCopyCancelled(t)).then(()=>{t.copyStatus=a.o.SynchronousPhaseCompleted,Object(a.mc)().ULS.traceTag(595937153,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopy: updating metadata for copy id ${t.id} after status changed to SynchronousPhaseCompleted.`),this.metadataManager.updateMetadata({lastCopy:t})}).catch(e=>{if(t?Object(a.mc)().ULS.traceTag(595734744,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopy: catch error for copy id ${t.id}.`):Object(a.mc)().ULS.traceTag(595734745,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.onCopy: no copy context."),e&&e.reason){const t=e.reason;if(t===a.n.SuccessiveCutCopyOverridingPendingCutCopy||t===a.n.BlockedSynchronousCutCopy||t===a.n.CopyOperationCancelled)return Object(a.mc)().ULS.traceTag(595734746,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: synchronous copy failed to populate the clipboard. Rejecting the promise: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(e)}return Object(a.mc)().ULS.traceTag(596456159,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: synchronous copy failed to populate the clipboard. Ignoring this failure since the active selection will allow for the required functionality: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),this.metadataManager.updateMetadata({lastCopy:t}),Promise.resolve()}),this.rejectIfCopyCancelled(t).then(()=>this.setClipboardAsync(r.asynchronousResult,e,t))]).then(()=>this.rejectIfCopyCancelled(t)).then(()=>(this.copyCompleteCleanup(t,e),t),r=>{Object(a.mc)().ULS.traceTag(595734747,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopy: got error for copy id ${t.id}.`);let o=r;return this.copyCompleteCleanup(t,e),o||(Object(a.mc)().ULS.shipAssertTag(595854806,n.LogCategory.msoulscat_ES_EWAJS,!1,"copyPasteFlowManager.onCopy: promise rejected without error"),o=new a.m(a.n.UnknownCopyErrorType,"copyPasteFlowManager.onCopy failed without specified error")),o.copyContext=t,Promise.reject(o)})}catch(r){return this.copyCompleteCleanup(t,e),Object(a.mc)().ULS.traceTag(596456160,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to store content in the clipboard. Exception: ${n.utils.getStringifiedError(r)}. Call stack: ${r.stack?r.stack:"NA"}`),Promise.reject(new a.m(a.n.SaveToTheClipboardFailed,"Failed to store content in the clipboard (with an exception): "+r.message,r))}}onPaste(e){const t=new a.G;try{if(!e)return Promise.reject(new a.H(a.I.MissingArgumentError,"Missing commandParameters argument",new a.B(a.jb,"commandParameters")));e.isTimestampStoredInSystemClipboard=!0,t.id=Object(a.bb)(),t.sessionId=this.applicationHost.getSessionId(),t.commandParameters=e,t.clipboardItems=Object(a.sb)(),t.isClipboardInaccessible=!1,Object(a.mc)().ULS.traceTag(595685636,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("start"));const r=this.metadataManager.getCachedMetadata();t.copyContextSnapshot=r.lastCopy,this.applicationHost.initializePasteContext(t),t.copyContextSnapshot?Object(a.mc)().ULS.traceTag(595937154,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.onPaste: paste started for copy id "+t.copyContextSnapshot.id):Object(a.mc)().ULS.traceTag(595730637,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.onPaste: paste started and copy context is null");let o,i=!1;return e.skipClipboardAccess?(Object(a.mc)().ULS.traceTag(595685637,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("skipClipboardAccess")),o=Promise.resolve()):o=this.readFromClipboard(t,e).then(r=>{if(Object(a.mc)().ULS.traceTag(595685638,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("readFromClipboard_then")),e.isAsyncClipboardAPI&&this.isLocalstorageDepsInAsyncClipboardAPIRemoved){var o;let e={lastCopy:void 0};if(!this.isEmptyClipboard(r)){const o=r.getItem(a.Sb);var i,s,c,l,d,u;o&&(e=this.metadataManager.deserializeMetadata(o),(null==t||!t.copyContextSnapshot||t.copyContextSnapshot.id!==(null===(i=e)||void 0===i||null===(i=i.lastCopy)||void 0===i?void 0:i.id)||(null==t||null===(s=t.copyContextSnapshot)||void 0===s?void 0:s.id)===(null===(c=e)||void 0===c||null===(c=c.lastCopy)||void 0===c?void 0:c.id)&&(null==t||null===(l=t.copyContextSnapshot)||void 0===l?void 0:l.copyStatus)!==a.o.Completed&&(null===(d=e)||void 0===d||null===(d=d.lastCopy)||void 0===d?void 0:d.copyStatus)===a.o.Completed)&&(t.copyContextSnapshot=null===(u=e)||void 0===u?void 0:u.lastCopy,this.metadataManager.updateMetadata(e)))}null!==(o=e)&&void 0!==o&&o.lastCopy||(t.copyContextSnapshot=void 0,this.metadataManager.updateMetadata({lastCopy:void 0}),r.setItem(a.Wb,a.Yb))}return t.clipboardItems=r,Promise.resolve()},e=>e&&e.reason&&e.reason===a.I.ClipboardIsInaccessible?(t.isClipboardInaccessible=!0,Promise.resolve()):Promise.reject(e)),o.then(()=>e.isAsyncClipboardAPI&&this.isLocalstorageDepsInAsyncClipboardAPIRemoved?t:this.readClipboardItemsAgainIfMetadataNotSync(t,e)).then(()=>(Object(a.mc)().ULS.traceTag(595685639,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("getPasteFlowHandler")),this.getPasteFlowHandler(t))).then(e=>(i||e.beforePaste&&e.beforePaste(t),e)).then(r=>{if(Object(a.mc)().ULS.traceTag(595685640,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("getPasteFlowHandler_then")),(!e.isAsyncClipboardAPI||!this.isLocalstorageDepsInAsyncClipboardAPIRemoved)&&t.copyContextSnapshot&&t.copyContextSnapshot.copyStatus!==a.o.Completed&&r.shouldWaitForCopyToComplete(t)){Object(a.mc)().ULS.traceTag(595937155,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onPaste: pasteFlowHandler ask to waiting for copy (${t.copyContextSnapshot.id}) to complete. current status ${t.copyContextSnapshot.copyStatus}. copy session id is ${t.copyContextSnapshot.sessionId}`),Object(a.mc)().ULS.traceTag(595683427,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("onDeferredPasteStarted")),r.onDeferredPasteStarted(t);const o=this.continueWhenCopyComplete(e,t).then(e=>(Object(a.mc)().ULS.traceTag(595685642,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("onDeferredPasteCompleted")),r.onDeferredPasteCompleted(t),t.copyContextSnapshot=this.metadataManager.getCachedMetadata().lastCopy,t.clipboardItems=e,r),e=>(r.onDeferredPasteCompleted(t),Object(a.mc)().ULS.traceTag(595882504,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,`CopyPasteFlowManager.onPaste: got error while wait for deferred paste to complete. error: [${e}]`),Promise.reject(e)));return Object(a.mc)().ULS.traceTag(595685643,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("continueWhenCopyComplete")),this.testHook("continueWhenCopyComplete"),o}return Object(a.mc)().ULS.traceTag(595940941,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onPaste: not wait for copy(${t.copyContextSnapshot&&t.copyContextSnapshot.id}) to complete. is copyContextSnapshot defined: ${void 0!==t.copyContextSnapshot}. copyStatus: ${t.copyContextSnapshot&&t.copyContextSnapshot.copyStatus}`),r}).then(e=>this.deserialize(e,t)).then(()=>{Object(a.mc)().ULS.traceTag(595685644,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("deserialize_then")),t.clipboardItems&&t.clipboardItems.getItem(a.Wb)===a.Yb&&(Object(a.mc)().ULS.traceTag(595685645,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("onSystemClipboardChangedExternally")),this.onSystemClipboardChangedExternally())}).then(()=>{const e=t.clipboardItems;if(void 0===e)return;const r=e.getItem(a.lc);if(void 0!==r){const e=a.Bb.getExternalSource(r);void 0!==e&&(t.externalAppSource=e)}}).then(()=>t).catch(e=>{let r=e;return r||(Object(a.mc)().ULS.shipAssertTag(595858762,n.LogCategory.msoulscat_ES_EWAJS,!1,"copyPasteFlowManager.onPaste: promise rejected without error"),r=new a.H(a.I.UnknownPasteError,"copyPasteFlowManager.onPaste failed without specified error")),r.pasteContext=t,Promise.reject(r)})}catch(e){return Object(a.mc)().ULS.shipAssertTag(596456161,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. Exception: "+n.utils.getStringifiedError(e)),Promise.reject(new a.H(a.I.FailedToReadFromClipboard,"Failed to read data from the clipboard (with an exception): "+e.message,e,t))}}onCancelCopy(e){try{if(this.inProgressCopyContext?(this.inProgressCopyContext.markForCancellation=!0,Object(a.mc)().ULS.traceTag(595734748,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCancelCopy: canceling copy for copy id ${this.inProgressCopyContext.id}.`)):Object(a.mc)().ULS.traceTag(595734749,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.onCancelCopy: no inProgressCopyContext."),!e)return Promise.resolve();this.metadataManager.clear();const t=Object(a.sb)(),r={isKeyboardEvent:!1,silentClipboardAccessFailures:!0,commandType:a.r.Copy};return this.clipboardStrategy.set(t,r).catch(e=>(Object(a.mc)().ULS.traceTag(596456162,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCancelCopy: Failed to clear the clipboard: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new a.c(a.d.FailedToClearClipboard,"Failed to clear the clipboard: "+e.message,e))))}catch(e){return Object(a.mc)().ULS.traceTag(596456163,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteInfra.copyPasteFlowManager.onCancelCopy: Failed to clear the clipboard. Exception: "+n.utils.getStringifiedError(e)),Promise.reject(new a.c(a.d.FailedToClearClipboard,"Failed to clear the clipboard (with an exception): "+e.message,e))}}onSystemClipboardChangedExternally(){var e=this;return _async_to_generator((function*(){e.onCancelCopy(!1),e.metadataManager.updateMetadata({lastCopy:void 0});const t={isKeyboardEvent:!1,silentClipboardAccessFailures:!0,commandType:a.r.Copy};yield e.clipboardStrategy.onSystemClipboardChangedExternally(t)}))()}readClipboardItemsAgainIfMetadataNotSync(e,t){let r=!1;return this.metadataManager.getMetadataSyncPromise().then(t=>{t&&t.lastCopy?(e.copyContextSnapshot&&(r=t.lastCopy.id!==e.copyContextSnapshot.id||t.lastCopy.copyStatus!==e.copyContextSnapshot.copyStatus),e.copyContextSnapshot=t.lastCopy,Object(a.mc)().ULS.traceTag(595937158,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`MetadataManager.readClipboardItemsAgainIfMetadataNotSync: metadata is sync. copy id = ${e.copyContextSnapshot.id}. copy status = ${e.copyContextSnapshot.copyStatus}. isMetadataChanged = ${r}`)):Object(a.mc)().ULS.traceTag(595937025,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"MetadataManager.readClipboardItemsAgainIfMetadataNotSync: metadata or metadata.lastCopy are not defined. This should be possible only when the last copy was external (i.e. there is no previous copy operation in xlo). do nothing")}).then(()=>r?this.readRichClipboardOnly(e,t,e.clipboardItems):Promise.resolve(e.clipboardItems)).then(t=>(e.clipboardItems=t,e))}getCopyFlowHandler(e){let t;try{t=this.applicationHost.getCopyFlowHandler(e)}catch(e){throw Object(a.mc)().ULS.shipAssertTag(596456192,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: applicationHost.getCopyFlowHandler failed with an exception: "+n.utils.getStringifiedError(e)),new a.m(a.n.FetchCopyFlowHandlerFailed,"applicationHost.getCopyFlowHandler failed with an exception: "+e.message,e)}if(!t){const e="CopyPasteInfra.copyPasteFlowManager.onCopy: applicationHost.getCopyFlowHandler should return an object. Try again later, when the CCP infra is loaded.";throw Object(a.mc)().ULS.shipAssertTag(596456193,n.LogCategory.msoulscat_ES_EWAJS,!1,e),new a.m(a.n.CopyFlowHandlerNotFound,e)}return t}getSourceItem(e,t){try{return e.getSourceItem(t)}catch(e){throw Object(a.mc)().ULS.shipAssertTag(596456194,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.getSourceItem failed with an exception: "+n.utils.getStringifiedError(e)),new a.m(a.n.FetchSourceItemFailed,"applicationHost.getSourceItem failed with an exception: "+e.message,e)}}serialize(e,t){try{e.beforeSerialize(t)}catch(e){throw Object(a.mc)().ULS.shipAssertTag(596456195,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.beforeSerialize failed with an exception: "+n.utils.getStringifiedError(e)),new a.m(a.n.BeforeSerializeFailed,"copyFlowHandler.beforeSerialize failed with an exception: "+e.message,e)}let r;try{r=e.serialize(t)}catch(e){throw Object(a.mc)().ULS.shipAssertTag(596456196,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.serialize failed with an exception: "+n.utils.getStringifiedError(e)),new a.m(a.n.SerializeFailed,"copyFlowHandler.serialize failed with an exception: "+e.message,e)}if(!r)throw Object(a.mc)().ULS.shipAssertTag(596456197,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onCopy: copyFlowHandler.serialize should return a non null result"),new a.m(a.n.SerializeResultNotValid,"copyFlowHandler.serialize should return a non null result");return r}setClipboardSync(e,t,r){try{r?Object(a.mc)().ULS.traceTag(595734750,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.setClipboardSync: start setClipboardSync for copy id ${r.id}.`):Object(a.mc)().ULS.traceTag(595734751,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.setClipboardSync: no copy context.");let o=e;return o||(o=Object(a.sb)()),this.clipboardStrategy.set(o,t).catch(e=>{if(Object(a.mc)().ULS.traceTag(596456198,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to synchronously store content in the clipboard. isKeyboardEvent: ${t.isKeyboardEvent}, Error: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),e&&void 0!==e.reason){const t=e;if(t.reason===a.f.ClipboardIsInaccessible)return Promise.reject(new a.m(a.n.ClipboardIsInaccessible,t.message,t));if(t.reason===a.f.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation)return Promise.reject(new a.m(a.n.SuccessiveCutCopyOverridingPendingCutCopy,"A successive Cut/Copy user event occurred before the last Cut/Copy browser event fired: "+t.message,t));if(t.reason===a.f.RejectingBlockedSyncCutCopyPromise)return Promise.reject(new a.m(a.n.BlockedSynchronousCutCopy,"In the user Cut/Copy operation, the async part occurred before its predecessor sync Cut/Copy browser event fired: "+t.message,t))}return Promise.reject(new a.m(a.n.SaveToTheClipboardFailed,"Failed to synchronously store content in the clipboard: "+e.message,e))}).then(()=>{r.succeededPopulatingSystemClipboardSync=t.isTimestampStoredInSystemClipboard})}catch(e){return Object(a.mc)().ULS.shipAssertTag(596456199,n.LogCategory.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to synchronously store content in the clipboard. Exception: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new a.m(a.n.SaveToTheClipboardFailed,"Failed to synchronously store content in the clipboard (with an exception): "+e.message,e))}}setClipboardAsync(e,t,r){return Object(a.mc)().ULS.traceTag(595734752,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.setClipboardAsync: start setClipboardAsync for copy id ${r.id}.`),e?e.then(e=>{try{if(this.isEmptyClipboard(e))return Promise.resolve();this.isLocalstorageDepsInAsyncClipboardAPIRemoved&&e.setItem(a.Sb,this.metadataManager.serializeMetadata({lastCopy:_object_spread_props(_object_spread({},r),{copyStatus:a.o.Completed})}));const o=t.stopwatch;t.stopwatch=void 0;const i=_object_spread({},t);return i.isTimestampStoredInSystemClipboard=!1,t.stopwatch=o,t.isKeyboardEvent&&(i.isKeyboardEvent=!1,i.silentClipboardAccessFailures=!0),this.clipboardStrategy.set(e,i).catch(e=>(Object(a.mc)().ULS.traceTag(596456200,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously store content in the clipboard: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),e&&void 0!==e.reason&&e.reason===a.f.ClipboardIsInaccessible?Promise.resolve():Promise.reject(new a.m(a.n.SaveToTheClipboardFailed,"Failed to asynchronously store content in the clipboard: "+(e&&e.message),e)))).then(()=>{r.succeededPopulatingSystemClipboardAsync=i.isTimestampStoredInSystemClipboard})}catch(e){return Object(a.mc)().ULS.shipAssertTag(596456201,n.LogCategory.msoulscat_ES_EWAJS,!1,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously store content in the clipboard. Exception: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),Promise.reject(new a.m(a.n.SaveToTheClipboardFailed,"Failed to asynchronously store content in the clipboard (with an exception): "+e.message,e))}},e=>(r.isAsyncSerializeFailed=!0,Object(a.mc)().ULS.traceTag(596456202,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onCopy: Failed to asynchronously serialize the content - Marking copyContext.isAsyncSerializeFailed as true. Error: ${n.utils.getStringifiedError(e)}. Call stack: ${e&&e.stack?e.stack:"NA"}`),Promise.reject(new a.m(a.n.AsyncSerializeFailed,"Failed to asynchronously serialize the content. Error: "+(e?e.message:"..."),e)))):(Object(a.mc)().ULS.traceTag(595734753,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.setClipboardAsync: no clipboardItemsPromise. resolving promise for copy id ${r.id}.`),Promise.resolve())}isEmptyClipboard(e){return e?0===Object(a.nb)(e)&&(Object(a.mc)().ULS.traceTag(596456204,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteInfra.copyPasteFlowManager.onCopy: the async serialization result does not contain items."),!0):(Object(a.mc)().ULS.traceTag(596456203,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"CopyPasteInfra.copyPasteFlowManager.onCopy: the async serialization result is undefined."),!0)}readFromClipboard(e,t){Object(a.mc)().ULS.traceTag(595685646,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,e.profilingMessage("readFromClipboard")),e.copyContextSnapshot&&(t.isTimestampStoredInSystemClipboard=e.copyContextSnapshot.isTimestampStoredInSystemClipboard);const r=this.clipboardStrategy.get(t);return Object(a.mc)().ULS.traceTag(595685647,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,e.profilingMessage("readFromClipboard_ret")),r?r.then(t=>(Object(a.mc)().ULS.traceTag(595685648,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,e.profilingMessage("readFromClipboard_then")),t?Promise.resolve(t):(Object(a.mc)().ULS.traceTag(596456206,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Error,"CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. Intercepted a missing clipboard item collection"),Promise.reject(new a.H(a.I.FailedToReadFromClipboard,"Failed to read data from the clipboard. Intercepted a missing clipboard item collection",new a.H(a.I.ClipboardIsEmpty,a.jb))))),e=>{if(Object(a.mc)().ULS.traceTag(596456207,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard: ${n.utils.getStringifiedError(e)}. Call stack: ${e.stack?e.stack:"NA"}`),t.isPasteCommandFromRecoveryUI&&t.pasteRecoveryCachedClipboardItems)return Object(a.mc)().ULS.traceTag(577249542,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteInfra.copyPasteFlowManager.onPaste: Returning 'pasteRecoveryCachedClipboardItems'"),Promise.resolve(t.pasteRecoveryCachedClipboardItems);const r=e;return Object(a.Hb)(e,a.f.ClipboardIsInaccessible)?Promise.reject(new a.H(a.I.ClipboardIsInaccessible,r.message,r)):Object(a.Hb)(e,a.f.RejectingPendingPastePromiseDueToNewPasteOperation)?Promise.reject(new a.H(a.I.SuccessivePasteOverridingPendingPaste,"A successive Paste user event occurred before the last Paste browser event fired: "+r.message,r)):Promise.reject(new a.H(a.I.FailedToReadFromClipboard,"Failed to read data from the clipboard: "+e.message,e))}):(Object(a.mc)().ULS.shipAssertTag(596456205,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onPaste: Failed to read data from the clipboard. clipboardStrategy.get() did not return an object"),Promise.reject(new a.H(a.I.FailedToReadFromClipboard,"Failed to read data from the clipboard. clipboardStrategy.get() did not return an object",new a.H(a.I.ReadFromClipboardReturnNullOrUndefined,a.jb))))}getPasteFlowHandler(e){let t;try{t=this.applicationHost.getPasteFlowHandler(e)}catch(e){throw Object(a.mc)().ULS.shipAssertTag(596456208,n.LogCategory.msoulscat_ES_EWAJS,!1,"CopyPasteInfra.copyPasteFlowManager.onPaste: applicationHost.getPasteFlowHandler failed. Exception: "+n.utils.getStringifiedError(e)),new a.H(a.I.FetchPasteFlowHandlerFailed,"applicationHost.getPasteFlowHandler failed with an exception: "+e.message,e)}if(!t){const e="CopyPasteInfra.copyPasteFlowManager.onPaste: applicationHost.getPasteFlowHandler should return an object. Try again later, when the CCP infra is loaded.";throw Object(a.mc)().ULS.shipAssertTag(596456209,n.LogCategory.msoulscat_ES_EWAJS,!1,e),new a.H(a.I.PasteFlowHandlerNotFound,e)}return t}deserialize(e,t){return Object(a.mc)().ULS.traceTag(595683456,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,t.profilingMessage("deserialize")),e.deserialize(t).catch(e=>{const t=n.utils.getStringifiedError(e);return Object(a.mc)().ULS.traceTag(596456210,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteInfra.copyPasteFlowManager.onPaste: Deserialization failed: ${t}.`),Promise.reject(new a.H(a.I.DeserializeOperationFailed,"Deserialization failed: "+t,e))})}copyCompleteCleanup(e,t){e?(Object(a.mc)().ULS.traceTag(595734754,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.copyCompleteCleanup: start copy complete for copy id ${e.id}.`),t&&(e.isTimestampStoredInSystemClipboard=t.isTimestampStoredInSystemClipboard),e&&this.inProgressCopyContext&&e.id===this.inProgressCopyContext.id?(this.inProgressCopyContext=void 0,e.copyStatus=a.o.Completed,Object(a.mc)().ULS.traceTag(595937159,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.copyCompleteCleanup: updating metadata for copy id ${e.id} after copy completed.`),this.metadataManager.updateMetadata({lastCopy:e})):Object(a.mc)().ULS.traceTag(595734755,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.copyCompleteCleanup: not setting copy status to complete state for copy id ${e.id}.`)):Object(a.mc)().ULS.traceTag(595734784,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.copyCompleteCleanup: no copy context.")}readRichClipboardOnly(e,t,r){return t.skipSystemClipboardAccess=!0,this.readFromClipboard(e,t).then(e=>(Object(a.mc)().ULS.traceTag(595937160,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.readRichClipboardOnly: get clipboard items."),e),e=>(Object(a.mc)().ULS.traceTag(595940942,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,`CopyPasteFlowManager.readRichClipboardOnly: reading form rich clipboard failed with error: ${n.utils.getStringifiedError(e)}. use clipboard items from the first read as fallback.`),Promise.resolve(r)))}continueWhenCopyComplete(e,t){if(!t||!t.copyContextSnapshot)return Promise.resolve(void 0);if(t.copyContextSnapshot.copyStatus===a.o.Completed)return Promise.resolve(void 0);if(this.deferredPasteData&&this.deferredPasteData.copyContextId!==t.copyContextSnapshot.id&&(Object(a.mc)().ULS.shipAssertTag(595937161,n.LogCategory.msoulscat_ES_EWAJS,!1,`CopyPasteFlowManager.continueWhenCopyComplete: deferred paste for another copy(${this.deferredPasteData.copyContextId} !== ${t.copyContextSnapshot.id}) exist, this is not expected as we should clean deferred paste data when new copy started(both same and cross session)`),this.rejectDeferredPasteData(a.I.DeferredPasteRejectedBecauseOtherCopyCompleted)),!this.deferredPasteData){const r=this.metadataManager.getCachedMetadata();if(r&&r.lastCopy&&r.lastCopy.copyStatus===a.o.Completed&&r.lastCopy.id===t.copyContextSnapshot.id)return Object(a.mc)().ULS.traceTag(595937162,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.continueWhenCopyComplete: copy ${r.lastCopy.id} already completed, not need for waiting any longer, reading the rich clipboard items`),this.readRichClipboardOnly(t,e,t.clipboardItems);const o=Object(a.V)(),i=o.promise.then(()=>this.readRichClipboardOnly(t,e,t.clipboardItems));this.deferredPasteData={copyContextId:t.copyContextSnapshot.id,copyCompleteDeferredPromise:o,readClipboardPromise:i,numberOfDeferredPaste:0,createdDate:new Date}}return this.deferredPasteData.numberOfDeferredPaste+=1,Object(a.mc)().ULS.traceTag(595937163,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.continueWhenCopyComplete: new deferred paste created for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}`),this.deferredPasteData.readClipboardPromise}rejectDeferredPasteData(e){if(this.deferredPasteData){Object(a.mc)().ULS.traceTag(595937164,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.rejectDeferredPasteData: reject deferred pastes for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}. totalTime = ${(new Date).getTime()-this.deferredPasteData.createdDate.getTime()}ms`);const t=this.deferredPasteData.copyCompleteDeferredPromise;this.deferredPasteData=void 0,t.reject(new a.H(e,"CopyPasteFlowManager.rejectDeferredPasteData: reject deferred paste"))}}resolveDeferredPasteData(){if(this.deferredPasteData){Object(a.mc)().ULS.traceTag(595937165,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.resolveDeferredPasteData: resolve deferred pastes for copy id: ${this.deferredPasteData.copyContextId}. number of deferred paste for this copy is: ${this.deferredPasteData.numberOfDeferredPaste}. first deferred paste created time: ${this.deferredPasteData.createdDate.toUTCString()}. totalTime = ${(new Date).getTime()-this.deferredPasteData.createdDate.getTime()}ms`);const e=this.deferredPasteData.copyCompleteDeferredPromise;this.deferredPasteData=void 0,e.resolve()}}rejectIfCopyCancelled(e){return e?Object(a.mc)().ULS.traceTag(595734785,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: start rejectIfCopyCancelled for copy id ${e.id}.`):Object(a.mc)().ULS.traceTag(595734786,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.rejectIfCopyCancelled: no copy context."),e&&e.markForCancellation?(Object(a.mc)().ULS.traceTag(595734787,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: reject for copy id ${e.id}.`),Promise.reject(new a.m(a.n.CopyOperationCancelled,`CopyPasteFlowManager.rejectIfCopyCancelled: Rejecting since copyContext with id ${e.id} is marked for cancellation`))):(e&&Object(a.mc)().ULS.traceTag(595734788,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.rejectIfCopyCancelled: resolve for copy id ${e.id}.`),Promise.resolve())}clearInProgressCopyIfNeeded(e){e&&e.markForCancellation||!this.inProgressCopyContext||e&&this.inProgressCopyContext.id===e.id||(Object(a.mc)().ULS.traceTag(595937166,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.clearInProgressCopyIfNeeded: cancel previous in-progress copy (id = ${this.inProgressCopyContext.id}) as new copy started (${e.id})`),this.inProgressCopyContext.markForCancellation=!0,this.inProgressCopyContext=void 0)}onMetadataChanged(e){e&&e.lastCopy?(Object(a.mc)().ULS.traceTag(595937167,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onMetadataChanged: the status of copy id ${e.lastCopy.id} from session ${e.lastCopy.sessionId} changed to ${e.lastCopy.copyStatus}`),this.clearInProgressCopyIfNeeded(e.lastCopy),this.deferredPasteData&&e.lastCopy.id!==this.deferredPasteData.copyContextId&&(Object(a.mc)().ULS.traceTag(595734789,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onMetadataChanged: reject deferred paste because copy id ${e.lastCopy.id} is not equal to ${this.deferredPasteData.copyContextId}`),this.rejectDeferredPasteData(a.I.DeferredPasteRejectedBecauseOtherCopyStarted)),e.lastCopy.copyStatus===a.o.Completed&&this.onCopyCompletedSuccessfully(e.lastCopy)):(Object(a.mc)().ULS.traceTag(595734790,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.onMetadataChanged: no metadata or no metadata.lastCopy"),this.deferredPasteData&&(Object(a.mc)().ULS.traceTag(595724049,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,"CopyPasteFlowManager.onMetadataChanged: reject deferred paste because metadata update without copy context"),this.rejectDeferredPasteData(a.I.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext)))}onCopyCompletedSuccessfully(e){e?Object(a.mc)().ULS.traceTag(595734791,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Info,`CopyPasteFlowManager.onCopyCompletedSuccessfully: start onCopyCompletedSuccessfully for copy id ${e.id}.`):Object(a.mc)().ULS.traceTag(595734792,n.LogCategory.msoulscat_ES_EWAJS,n.TraceLevel.Warning,"CopyPasteFlowManager.onCopyCompletedSuccessfully: no copy context."),this.deferredPasteData&&e&&e.copyStatus===a.o.Completed&&e.id===this.deferredPasteData.copyContextId&&this.resolveDeferredPasteData()}testHook(e){}constructor(e,t,r){if(this.clipboardPlatformEnvironment=e,this.applicationHost=t,this.inProgressCopyContext=void 0,this.deferredPasteData=void 0,this.isLocalstorageDepsInAsyncClipboardAPIRemoved=!1,!r)throw new a.B(a.jb,"logger");Object(a.Eb)(r),Object(a.mc)().ULS.shipAssertTag(596456157,n.LogCategory.msoulscat_ES_EWAJS,!!e,"CopyPasteInfra.copyPasteFlowManager.ctor: missing 'clipboardPlatformEnvironment' argument"),Object(a.mc)().ULS.shipAssertTag(596456158,n.LogCategory.msoulscat_ES_EWAJS,!!t,"CopyPasteInfra.copyPasteFlowManager.ctor: missing 'applicationHost' argument"),this.metadataManager=e.getMetadataManager(),this.metadataManager.addMetadataChangeListener("CopyPasteFlowManagerOnMetadataChangedListener",this.onMetadataChanged.bind(this)),Object(a.mc)().ULS.shipAssertTag(596456156,n.LogCategory.msoulscat_ES_EWAJS,!!this.metadataManager,"CopyPasteInfra.copyPasteFlowManager.ctor: metadataManager is not valid"),this.isLocalstorageDepsInAsyncClipboardAPIRemoved=Object(o.a)("Microsoft.Office.Excel.RemoveLocalstorageDepsInAsyncClipboardAPI",!1)}}var c=r(5);function l(e){(class{static setFeatureGateManager(e){Object(o.b)(e)}}).setFeatureGateManager(e)}},7:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promises=void 0;const o={};t.promises=function(){return void 0===o.promises&&(o.promises="undefined"!=typeof Promise&&"function"==typeof Promise.resolve&&"function"==typeof Promise.resolve(0).then),o.promises}},8:function(e,t,r){"use strict";function o(){const e="undefined"!=typeof self?self:window;return e.performance&&e.performance.now?e.performance.now():Date.now()}function a(e,t,r){e[t]=o()-r}Object.defineProperty(t,"__esModule",{value:!0}),t.timeStamp=t.failure=t.success=t.end=t.mark=t.start=void 0,t.start=function(e){const t=o(),r=e,n=t,i={},s=(e,t,o)=>function(e,t,r,o,n,i){a(e,"end",r);const s={sessionName:t,result:o?"success":"failure",message:i,marks:e};n(JSON.stringify(s))}(i,r,n,e,t,o);return i.start=0,{mark:e=>(e=>a(i,e,n))(e),end:e=>s(!0,e),success:(e,t)=>s(!0,e,t),failure:(e,t)=>s(!1,e,t)}},t.mark=function(e,t){void 0!==e&&e.mark(t)},t.end=function(e,t){void 0!==e&&e.end(t)},t.success=function(e,t,r){void 0!==e&&e.success(t,r)},t.failure=function(e,t,r){void 0!==e&&e.failure(t,r)},t.timeStamp=o}});
//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/copyPasteInfra.min.js.map/a0677c496ce2d0c35af72871d92fd683/copyPasteInfra.min.js.map